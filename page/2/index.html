<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="for the dream">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="for the dream">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="for the dream">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>for the dream</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">for the dream</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/29/ELK/ubuntu14-04上单机部署ELK6-1-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ygqqq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="for the dream">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/29/ELK/ubuntu14-04上单机部署ELK6-1-1/" itemprop="url">ubuntu14.04上单机部署ELK6.1.1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-29T00:00:00+08:00">
                2017-09-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ELK/" itemprop="url" rel="index">
                    <span itemprop="name">ELK</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="部署elasticsear6-1-1"><a href="#部署elasticsear6-1-1" class="headerlink" title="部署elasticsear6.1.1"></a>部署elasticsear6.1.1</h1><h2 id="配置java环境"><a href="#配置java环境" class="headerlink" title="配置java环境"></a>配置java环境</h2><p>elasticsear6.1.1需要1.8版本以上的jdk，所以如果环境不满足的话，需要先配置java运行环境。</p>
<p>这里用到的是<code>jdk-8u151-linux-x64.tar.gz</code>包，可以自行去oracle官网下载。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">tar xf jdk-8u151-linux-x64.tar.gz -C /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量，编辑/etc/profile文件，尾部追加：</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_151</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre  </span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib  </span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重读配置文件</span></span><br><span class="line">. /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看jdk版本</span></span><br><span class="line">java -version    <span class="comment">#  -&gt; java version "1.8.0_151"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="部署elasticsearch"><a href="#部署elasticsearch" class="headerlink" title="部署elasticsearch"></a>部署elasticsearch</h2><p>es运行需要非root账户，所以要先添加一个新账户，假设为es:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd es</span><br></pre></td></tr></table></figure></p>
<p>解压文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载es官方包</span></span><br><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.1.1.tar.gz</span><br><span class="line"></span><br><span class="line">tar xf elasticsearch-6.1.1.tar.gz -C /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改文件属主和属组为es用户</span></span><br><span class="line">chown es:es -R  /usr/<span class="built_in">local</span>/elasticsearch-6.1.1/</span><br></pre></td></tr></table></figure></p>
<p>修改配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/elasticsearch-6.1.1/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line"><span class="comment">#不修改这个的话，默认只能在本地访问</span></span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment">#另外还有比如es集群名称,node名称、默认端口之类的要根据实际情况进行修改，这里就直接使用默认的了</span></span><br></pre></td></tr></table></figure></p>
<p>运行es<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#切换到es用户</span></span><br><span class="line">su - es</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/elasticsearch-6.1.1/</span><br><span class="line"><span class="comment">#建议在后台运行</span></span><br><span class="line">./bin/elasticsearch &amp;</span><br></pre></td></tr></table></figure></p>
<p>这时es很有可能会报错，首先es禁止使用root账户直接运行。另外可能还会报如下错误：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1]: max file descriptors [4096] <span class="keyword">for</span> elasticsearch process is too low, increase to at least [65536]</span><br><span class="line">[2]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</span><br></pre></td></tr></table></figure></p>
<p>此时就要修改相关参数(需要root权限)：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改es用户的linux文件最大打开数量的限制:</span></span><br><span class="line">cp /etc/security/limits.conf /etc/security/limits.conf.bak</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"es hard nofile 65536"</span> &gt;&gt; /etc/security/limits.conf </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"es soft nofile 65536"</span> &gt;&gt; /etc/security/limits.conf</span><br></pre></td></tr></table></figure></p>
<p>修改max_map_count</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"vm.max_map_count=262144"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>
<p>然后再重新登录es用户，再次运行es即可。最后可使用<code>ss -tnl</code>查看是否已经监听在了9200端口，如果监听了就说明运行正常。</p>
<h1 id="部署logstash"><a href="#部署logstash" class="headerlink" title="部署logstash"></a>部署logstash</h1><h2 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/logstash/logstash-6.1.1.tar.gz</span><br><span class="line"></span><br><span class="line">tar xf logstash-6.1.1.tar.gz -C /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/logstash-6.1.1</span><br></pre></td></tr></table></figure>
<h2 id="编辑logstash配置文件"><a href="#编辑logstash配置文件" class="headerlink" title="编辑logstash配置文件"></a>编辑logstash配置文件</h2><p>读取apache日志文件，并输出保存到es中<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">vim config/logstash.conf</span><br><span class="line"></span><br><span class="line">input &#123;  </span><br><span class="line">  file &#123;  </span><br><span class="line">    path =&gt; [<span class="string">"/var/log/apache2/access_log"</span>] </span><br><span class="line">    start_position =&gt; beginning  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">filter &#123;  </span><br><span class="line"> grok &#123;  </span><br><span class="line">      match =&gt; &#123; <span class="string">"message"</span> =&gt; <span class="string">"%&#123;COMBINEDAPACHELOG&#125;"</span> &#125;  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">output &#123;  </span><br><span class="line">  elasticsearch &#123;   </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">bin/logstash -f config/logstash.conf</span><br></pre></td></tr></table></figure></p>
<h1 id="kibana部署配置"><a href="#kibana部署配置" class="headerlink" title="kibana部署配置"></a>kibana部署配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wget https://artifacts.elastic.co/downloads/kibana/kibana-6.1.1-linux-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line">tar xf kibana-6.1.1-linux-x86_64.tar.gz -C /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/kibana-6.1.1-linux-x86_64</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改配置文件</span></span><br><span class="line">vim config/kibana.yml</span><br><span class="line">server.host: <span class="string">"0.0.0.0"</span></span><br><span class="line"></span><br><span class="line">bin/kibana &amp;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/28/mysql/构造千万级数据mysql测试环境/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ygqqq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="for the dream">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/28/mysql/构造千万级数据mysql测试环境/" itemprop="url">快速构造千万级数据mysql测试环境</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-28T00:00:00+08:00">
                2017-09-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="构造数据表"><a href="#构造数据表" class="headerlink" title="构造数据表"></a>构造数据表</h1><p>课程表，假设有10门课程：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> course(</span><br><span class="line">    -&gt; <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">2</span>) auto_increment primary <span class="keyword">key</span>,</span><br><span class="line">    -&gt; cname <span class="built_in">varchar</span>(<span class="number">8</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    -&gt; teacher <span class="built_in">varchar</span>(<span class="number">8</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">    -&gt; ) <span class="keyword">engine</span>=<span class="keyword">innodb</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`course`</span> (<span class="string">`id`</span>, <span class="string">`cname`</span>, <span class="string">`teacher`</span>) <span class="keyword">VALUES</span> (<span class="literal">NULL</span>, <span class="string">'英语'</span>, <span class="string">'李三'</span>) ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`course`</span> (<span class="string">`id`</span>, <span class="string">`cname`</span>, <span class="string">`teacher`</span>) </span><br><span class="line"><span class="keyword">VALUES</span> (<span class="literal">NULL</span>, <span class="string">'C语言'</span>, <span class="string">'刘强'</span>), (<span class="literal">NULL</span>, <span class="string">'JAVA'</span>, <span class="string">'小红'</span>), (<span class="literal">NULL</span>, <span class="string">'NET'</span>, <span class="string">'老李'</span>), </span><br><span class="line">(<span class="literal">NULL</span>, <span class="string">'体育'</span>, <span class="string">'老王'</span>), (<span class="literal">NULL</span>, <span class="string">'自然科学'</span>, <span class="string">'王军'</span>), (<span class="literal">NULL</span>, <span class="string">'电商'</span>, <span class="string">'王天'</span>), (<span class="literal">NULL</span>, <span class="string">'GO'</span>, <span class="string">'安踏'</span>),</span><br><span class="line">(<span class="literal">NULL</span>, <span class="string">'英语'</span>, <span class="string">'李三'</span>),(<span class="literal">NULL</span>, <span class="string">'数学'</span>, <span class="string">'姚明'</span>),(<span class="literal">NULL</span>, <span class="string">'语文'</span>, <span class="string">'于广庆'</span>);</span><br></pre></td></tr></table></figure></p>
<p>学生表：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(</span><br><span class="line">    -&gt; <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">12</span>) AUTO_INCREMENT  PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    -&gt; <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    -&gt; age <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    -&gt; sex tinyint <span class="keyword">not</span> <span class="literal">null</span>) <span class="keyword">engine</span>=myisam;</span><br><span class="line"></span><br><span class="line">学生内存表：</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student_mem(</span><br><span class="line">    -&gt; <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">12</span>) AUTO_INCREMENT  PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    -&gt; <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    -&gt; age <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    -&gt; sex tinyint <span class="keyword">not</span> <span class="literal">null</span>) <span class="keyword">ENGINE</span> = <span class="keyword">MEMORY</span>;</span><br></pre></td></tr></table></figure></p>
<p>分数表：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sc(</span><br><span class="line">    -&gt; <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">12</span>) AUTO_INCREMENT  PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    -&gt; <span class="keyword">sid</span> <span class="built_in">int</span>(<span class="number">12</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生id'</span>,</span><br><span class="line">    -&gt; cid <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'课程id'</span>,</span><br><span class="line">    -&gt; score <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'分数'</span>) <span class="keyword">engine</span>=myisam;</span><br><span class="line"></span><br><span class="line">分数内存表：</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sc_mem(</span><br><span class="line">    -&gt; <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">12</span>) AUTO_INCREMENT  PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    -&gt; <span class="keyword">sid</span> <span class="built_in">int</span>(<span class="number">12</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学生id'</span>,</span><br><span class="line">    -&gt; cid <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'课程id'</span>,</span><br><span class="line">    -&gt; score <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'分数'</span>) <span class="keyword">ENGINE</span> = <span class="keyword">MEMORY</span>;</span><br></pre></td></tr></table></figure></p>
<h1 id="构造测试数据"><a href="#构造测试数据" class="headerlink" title="构造测试数据"></a>构造测试数据</h1><p>我们可以利用memory engine的表进行数据转存，这样会极大的提高数据构造速度。</p>
<p>写一个实现获取随机字符串的函数：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER // </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> <span class="string">`rand_string`</span>(n <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">CHARSET</span> latin1  </span><br><span class="line"><span class="keyword">BEGIN</span>   </span><br><span class="line"><span class="keyword">DECLARE</span> chars_str <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;   </span><br><span class="line"><span class="keyword">DECLARE</span> return_str <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> ;  </span><br><span class="line"><span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;   </span><br><span class="line">WHILE i &lt; n DO   </span><br><span class="line"><span class="keyword">SET</span> return_str = <span class="keyword">concat</span>(return_str,<span class="keyword">substring</span>(chars_str , <span class="keyword">FLOOR</span>(<span class="number">1</span> + <span class="keyword">RAND</span>()*<span class="number">62</span> ),<span class="number">1</span>));   </span><br><span class="line"><span class="keyword">SET</span> i = i +<span class="number">1</span>;   </span><br><span class="line"><span class="keyword">END</span> <span class="keyword">WHILE</span>;   </span><br><span class="line">RETURN return_str;   </span><br><span class="line"><span class="keyword">END</span>//</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></p>
<p>用存储过程生成数据，假设一个学生能且只能选择2门课程：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER // </span><br><span class="line"><span class="keyword">CREATE</span>  <span class="keyword">PROCEDURE</span> <span class="string">`add_student_and_score`</span>(<span class="keyword">IN</span> n <span class="built_in">int</span>)  </span><br><span class="line"><span class="keyword">BEGIN</span>    </span><br><span class="line">               </span><br><span class="line">  <span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;  </span><br><span class="line">  <span class="keyword">DECLARE</span> cid_1 <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> cid_2 <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">DECLARE</span> st_id <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">SET</span> AUTOCOMMIT=<span class="number">0</span>;                      <span class="comment">-- 关闭自动提交，提升执行速度</span></span><br><span class="line">    WHILE (i &lt;= n ) DO  </span><br><span class="line">        <span class="comment">-- 先像内存表插入数据</span></span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">into</span> student_mem (<span class="keyword">name</span>,age,sex) <span class="keyword">VALUEs</span> (rand_string(<span class="number">8</span>),<span class="keyword">floor</span>(<span class="number">15</span>+<span class="keyword">rand</span>()*<span class="number">10</span>),<span class="keyword">floor</span>(<span class="keyword">rand</span>()*<span class="number">2</span>));  </span><br><span class="line">        <span class="keyword">set</span> cid_1=<span class="keyword">floor</span>(<span class="number">1</span>+<span class="keyword">rand</span>()*<span class="number">9</span>);</span><br><span class="line">        <span class="keyword">set</span> cid_2=cid_1+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">set</span> st_id=<span class="keyword">last_insert_id</span>();</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">into</span> sc_mem (<span class="keyword">sid</span>,cid,score) <span class="keyword">VALUEs</span> (st_id,cid_1,<span class="keyword">floor</span>(<span class="number">1</span>+<span class="keyword">rand</span>()*<span class="number">99</span>)),(st_id,cid_2,<span class="keyword">floor</span>(<span class="number">1</span>+<span class="keyword">rand</span>()*<span class="number">99</span>));  </span><br><span class="line"></span><br><span class="line">        <span class="keyword">set</span> i=i+<span class="number">1</span>;  </span><br><span class="line">        IF MOD(i,100000)&lt;=0 THEN        --每10W条数据提交一次</span><br><span class="line">            <span class="keyword">COMMIT</span>;</span><br><span class="line">        <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">WHILE</span>;  </span><br><span class="line">    <span class="comment">--再将内存表中的数据插入实际表，这样插入可避免主键冲突，使存储过程重复利用</span></span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">into</span> student(<span class="keyword">name</span>,age,sex) <span class="keyword">select</span> <span class="keyword">name</span>,age,sex <span class="keyword">from</span> student_mem;</span><br><span class="line">    <span class="keyword">INSERT</span> <span class="keyword">into</span> sc(<span class="keyword">sid</span>,cid,score) <span class="keyword">select</span> <span class="keyword">sid</span>,cid,score <span class="keyword">from</span> sc_mem;</span><br><span class="line"><span class="keyword">END</span>//  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure></p>
<p>调用存储过程添加学生，最好临时先关闭binlog，这样能加快很多时间。也可以使用内存表作为中转站，先将数据插入内存表，然后再转入实际的学生表和分数表，速度也会快很多。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> sql_log_bin=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--注意，在插入之前，最好先将表中之前建立的索引drop</span></span><br><span class="line"><span class="keyword">CALL</span> add_student_and_score(<span class="number">1000000</span>);  </span><br><span class="line">Query OK, 2000026 rows affected (1 min 4.85 sec)</span><br></pre></td></tr></table></figure></p>
<p>可以看到，插入100W条数据也只要1分钟，如果机器性能再好些，速度还会更快，这样就很容易快速构造千万级别的测试数据。</p>
<p>注意事项：<br>如果我们开启了<code>bin-log</code>,创建function的时候就要设定一下参数:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> log_bin_trust_function_creators=<span class="literal">TRUE</span>;</span><br></pre></td></tr></table></figure></p>
<p>如果运行过程中，报内存不够的错误:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> max_heap_table_size=<span class="number">4</span>*<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">1024</span>;    <span class="comment">--set max_heap_table_size=4194304000;</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/28/mysql/sql基础查询练习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ygqqq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="for the dream">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/28/mysql/sql基础查询练习/" itemprop="url">sql基础查询练习及索引优化分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-28T00:00:00+08:00">
                2017-09-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="表结构和相关说明"><a href="#表结构和相关说明" class="headerlink" title="表结构和相关说明"></a>表结构和相关说明</h2><p>注意，这里的例子，基本上每一个例子都有两种sql，一种是本文中的数据表结构的sql实现(纯练习所用)。下面还有一种是基于前面的博客[构造千万级数据表测试环境]所构造的表进行sql查询、索引分析。</p>
<p>另外这里写的一般都是比较复杂的查询，数据量极大的时候，难免会比较慢，即使经过优化，毕竟近千万条数据多表连接、子查询，甚至3层子查询等等的，效率肯定不高。具体情况下，很多类似的需求都可以通过其他一些程序代码或者配合nosql等方式来解决，这里只是单纯为了练习sql以及做下相关优化。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> course;</span><br><span class="line"></span><br><span class="line">+<span class="comment">-----+-----------------+---------+</span></span><br><span class="line">| CNO | CNAME           | TEACHER |</span><br><span class="line">+<span class="comment">-----+-----------------+---------+</span></span><br><span class="line">| K1  | C语言           | 王华    |</span><br><span class="line">| K5  | 数据库原理      | 程军    |</span><br><span class="line">| K8  | 编译原理        | 程军    |</span><br><span class="line">+<span class="comment">-----+-----------------+---------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> sc;</span><br><span class="line"></span><br><span class="line">+<span class="comment">-----+-----+-------+</span></span><br><span class="line">| SNO | CNO | SCORE |</span><br><span class="line">+<span class="comment">-----+-----+-------+</span></span><br><span class="line">| 1   | K1  |    83 |</span><br><span class="line">| 2   | K1  |    85 |</span><br><span class="line">| 2   | K5  |    90 |</span><br><span class="line">| 5   | K1  |    92 |</span><br><span class="line">| 5   | K5  |    84 |</span><br><span class="line">| 5   | K8  |    80 |</span><br><span class="line">+<span class="comment">-----+-----+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student;</span><br><span class="line"></span><br><span class="line">+<span class="comment">-----+--------+------+------+</span></span><br><span class="line">| SNO | SNAME  | AGE  | SEX  |</span><br><span class="line">+<span class="comment">-----+--------+------+------+</span></span><br><span class="line">| 1   | 李强   |   23 | 男   |</span><br><span class="line">| 2   | 刘丽   |   22 | 女   |</span><br><span class="line">| 5   | 张友   |   22 | 男   |</span><br><span class="line">+<span class="comment">-----+--------+------+------+</span></span><br></pre></td></tr></table></figure>
<h2 id="检索选修了全部课程的学生姓名："><a href="#检索选修了全部课程的学生姓名：" class="headerlink" title="检索选修了全部课程的学生姓名："></a>检索选修了全部课程的学生姓名：</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SNAME <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">      <span class="keyword">select</span> * <span class="keyword">from</span> course <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">          <span class="keyword">select</span> * <span class="keyword">from</span> sc <span class="keyword">where</span> sc.SNO=student.SNO <span class="keyword">and</span> sc.CNO=course.CNO</span><br><span class="line">      )         </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">---之前博客里面千万数据的例子</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 这个语句的问题主要在最外层和最内层，如果不使用索引，最外层500W行、最内层1000W行(每个学生2门课)，全表扫描简直姚明</span></span><br><span class="line"><span class="comment">-- 最外层，如果没有其他条件限制，必然会全表扫描，中间层影响较小，再看最内层，假设最外层循环到了学生id=1</span></span><br><span class="line"><span class="comment">-- 那么最内层就要执行sc.sid=1这种操作，如果没有sid或者cid(因为此时course.id已确定，根据cid也能迅速定位到数据)的话，那么只能全表扫描1000w行数据！</span></span><br><span class="line"><span class="comment">-- 而如果在sid或cid字段增加索引，那最内层就会非常迅速定位到数据，就能极大的提高查询效率</span></span><br><span class="line"><span class="comment">-- 但最外层还是得全表扫描，不过一般情况下，实际应用中，最外层应该也会有些额外条件来限制吧，如果能在其他限制条件上增加适合的索引，那么查询速度就成倍激增了</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">NAME</span> <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">      <span class="keyword">select</span> * <span class="keyword">from</span> course <span class="keyword">where</span> teacher=<span class="string">'于广庆'</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">          <span class="keyword">select</span> * <span class="keyword">from</span> sc <span class="keyword">where</span> sc.Sid=student.id <span class="keyword">and</span> sc.cid=course.id</span><br><span class="line">      )         </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 所以分析之后的结构就是，在sid或cid字段上增加索引，并且在最外层增加条件限制，使之使用索引</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">NAME</span> <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">      <span class="keyword">select</span> * <span class="keyword">from</span> course <span class="keyword">where</span> teacher=<span class="string">'于广庆'</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">          <span class="keyword">select</span> * <span class="keyword">from</span> sc <span class="keyword">where</span> sc.Sid=student.id <span class="keyword">and</span> sc.cid=course.id</span><br><span class="line">      )         </span><br><span class="line">) <span class="keyword">and</span> <span class="keyword">id</span>&lt;<span class="number">100000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> sc <span class="keyword">add</span> <span class="keyword">index</span> <span class="keyword">sid</span>;</span><br><span class="line"></span><br><span class="line">最终执行结果：</span><br><span class="line">9720 rows in <span class="keyword">set</span> (<span class="number">0.58</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--必须在sid列添加索引，否则就会全表扫描sc表，这查询时间就很恐怖了，加上这个索引查询时间会缩短很多倍</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> sc <span class="keyword">add</span> <span class="keyword">index</span>(<span class="keyword">sid</span>);</span><br></pre></td></tr></table></figure>
<h2 id="检索所有课程分数均大于84分的学生姓名："><a href="#检索所有课程分数均大于84分的学生姓名：" class="headerlink" title="检索所有课程分数均大于84分的学生姓名："></a>检索所有课程分数均大于84分的学生姓名：</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SNAME <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> sc <span class="keyword">where</span> sc.SNO=student.SNO <span class="keyword">and</span> sc.score&lt;<span class="number">84</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> SNAME <span class="keyword">from</span> student <span class="keyword">where</span> SNO <span class="keyword">not</span> <span class="keyword">in</span>(</span><br><span class="line">    <span class="keyword">select</span> SNO <span class="keyword">from</span> sc <span class="keyword">where</span> score&lt;<span class="number">84</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 这两种方式都可以实现，in 和 exists</span></span><br><span class="line"><span class="comment">-- 虽然有主键索引，但这里并没有类似id&gt;10000或id=1之类的条件,所以不管是in 还是exists，都采用的全表扫描</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">NAME</span> <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">not</span> <span class="keyword">in</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">sid</span> <span class="keyword">from</span> sc <span class="keyword">where</span> score&lt;<span class="number">84</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不知道是什么原因，内层明明满足sid索引的使用条件，但mysql优化器并没有使用这个索引，导致内层全表扫描，依然极慢</span></span><br><span class="line"><span class="comment">-- 使用force index强制使用sid索引，速度快了很多倍</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">NAME</span> <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">not</span> <span class="keyword">in</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">sid</span> <span class="keyword">from</span> sc <span class="keyword">force</span> <span class="keyword">index</span>(<span class="keyword">sid</span>) <span class="keyword">where</span> score&lt;<span class="number">84</span></span><br><span class="line">)  <span class="keyword">and</span> <span class="keyword">id</span>&gt;<span class="number">3500000</span>;</span><br><span class="line">600040 rows in <span class="keyword">set</span> (<span class="number">0.79</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">NAME</span> <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(  <span class="keyword">select</span> <span class="keyword">sid</span> <span class="keyword">from</span> sc <span class="keyword">force</span> <span class="keyword">index</span>(<span class="keyword">sid</span>) <span class="keyword">where</span> sc.sid=student.id <span class="keyword">and</span> sc.score&lt;<span class="number">84</span> ) <span class="keyword">and</span> <span class="keyword">id</span>&gt;<span class="number">3500000</span>;</span><br><span class="line">600040 rows in <span class="keyword">set</span> (<span class="number">0.73</span> sec)</span><br></pre></td></tr></table></figure>
<p>就这个例子来看，in和exists执行效率并没有特别大的不同，具体的执行时间肯定也和特定的情况不同，需要综合考虑很多因素来建立、使用索引，以及改造sql语句。</p>
<h2 id="查询所有学习了C语言的学生名称："><a href="#查询所有学习了C语言的学生名称：" class="headerlink" title="查询所有学习了C语言的学生名称："></a>查询所有学习了C语言的学生名称：</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">in</span>(<span class="keyword">SELECT</span> <span class="keyword">sid</span> <span class="keyword">from</span> sc <span class="keyword">WHERE</span> cid = (<span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">from</span> course <span class="keyword">WHERE</span> cname=<span class="string">'C语言'</span>));</span><br></pre></td></tr></table></figure>
<h2 id="统计各门课程的学习人数"><a href="#统计各门课程的学习人数" class="headerlink" title="统计各门课程的学习人数"></a>统计各门课程的学习人数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c.CNAME,<span class="keyword">COUNT</span>(sc.CNO) <span class="keyword">from</span> sc <span class="keyword">left</span> <span class="keyword">join</span> course <span class="keyword">as</span> c <span class="keyword">on</span> sc.CNO=c.CNO <span class="keyword">group</span> <span class="keyword">by</span> sc.CNO;</span><br><span class="line"></span><br><span class="line"><span class="comment">---之前博客里面千万数据的例子</span></span><br><span class="line"><span class="keyword">select</span> c.CNAME,<span class="keyword">COUNT</span>(sc.cid) <span class="keyword">from</span> sc <span class="keyword">left</span> <span class="keyword">join</span> course <span class="keyword">as</span> c <span class="keyword">on</span> sc.cid=c.id <span class="keyword">group</span> <span class="keyword">by</span> sc.cid;</span><br><span class="line"><span class="comment">--alter table sc add index (cid);   如果sc表没有cid的索引，就会对sc全表扫描</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/27/mysql/mysql基础：DDL、DCL、DML/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ygqqq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="for the dream">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/27/mysql/mysql基础：DDL、DCL、DML/" itemprop="url">mysql基础：DDL、DCL、DML</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-27T00:00:00+08:00">
                2017-09-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="善用help命令"><a href="#善用help命令" class="headerlink" title="善用help命令"></a>善用help命令</h1><p>mysql的相关操作语句极多，而且参数也特别多，很难(并且也没必要)将其完完全全记住，但要善于使用help命令查看相关语句的一些具体语法和参数、选项。</p>
<p>这篇文章的目的不是为了罗列所有mysql语句和选项，因为这并没啥意义，只是希望通过一些例子能加深对一些命令的认知，更重要的是让自己能够在不记得某些命令的时候能去善用help去查找答案。</p>
<p>总结来说，除了查询select之外，应用最多的就是show、create、alter、drop、grant等。</p>
<p>例如使用help show查看所有show命令:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">help</span> <span class="keyword">show</span></span><br><span class="line"><span class="keyword">Name</span>: <span class="string">'SHOW'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> &#123;<span class="built_in">BINARY</span> | <span class="keyword">MASTER</span>&#125; <span class="keyword">LOGS</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">BINLOG</span> <span class="keyword">EVENTS</span> [<span class="keyword">IN</span> <span class="string">'log_name'</span>] [<span class="keyword">FROM</span> pos] [<span class="keyword">LIMIT</span> [<span class="keyword">offset</span>,] <span class="keyword">row_count</span>]</span><br><span class="line"><span class="keyword">SHOW</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> [like_or_where]</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">COLLATION</span> [like_or_where]</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> db_name</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tbl_name</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">DATABASES</span> [like_or_where]</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">ENGINE</span> engine_name &#123;<span class="keyword">STATUS</span> | <span class="keyword">MUTEX</span>&#125;</span><br><span class="line"><span class="keyword">SHOW</span> [<span class="keyword">STORAGE</span>] <span class="keyword">ENGINES</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GRANTS</span> <span class="keyword">FOR</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> tbl_name [<span class="keyword">FROM</span> db_name]</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">MASTER</span> <span class="keyword">STATUS</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> CODE proc_name</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> <span class="keyword">STATUS</span> [like_or_where]</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PRIVILEGES</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">SLAVE</span> <span class="keyword">HOSTS</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">SLAVE</span> <span class="keyword">STATUS</span></span><br><span class="line"><span class="keyword">SHOW</span> [<span class="keyword">GLOBAL</span> | <span class="keyword">SESSION</span>] <span class="keyword">STATUS</span> [like_or_where]</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLE</span> <span class="keyword">STATUS</span> [<span class="keyword">FROM</span> db_name] [like_or_where]</span><br><span class="line"><span class="keyword">SHOW</span> [<span class="keyword">GLOBAL</span> | <span class="keyword">SESSION</span>] <span class="keyword">VARIABLES</span> [like_or_where]</span><br><span class="line"></span><br><span class="line">like_or_where:</span><br><span class="line">    <span class="keyword">LIKE</span> <span class="string">'pattern'</span></span><br><span class="line">  | <span class="keyword">WHERE</span> expr</span><br></pre></td></tr></table></figure></p>
<p>这里只是大致列出了所有show命令的摘要信息，还可以进一步查看某show命令的详细使用：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">help</span> <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span></span><br></pre></td></tr></table></figure></p>
<h1 id="create命令"><a href="#create命令" class="headerlink" title="create命令"></a>create命令</h1><p>可以使用help查看所有create支持的子命令：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">help</span> <span class="keyword">create</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EVENT</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> UDF</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">SERVER</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLESPACE</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span></span><br></pre></td></tr></table></figure></p>
<p>这里只列举部分命令。</p>
<h2 id="create-databes"><a href="#create-databes" class="headerlink" title="create databes"></a>create databes</h2><blockquote>
<p>CHARACTER SET 可简写为charset</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">help</span> <span class="keyword">create</span> <span class="keyword">database</span></span><br><span class="line"><span class="keyword">Name</span>: <span class="string">'CREATE DATABASE'</span></span><br><span class="line">Description:</span><br><span class="line">Syntax:</span><br><span class="line"><span class="keyword">CREATE</span> &#123;<span class="keyword">DATABASE</span> | <span class="keyword">SCHEMA</span>&#125; [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] db_name</span><br><span class="line">    [create_specification] ...</span><br><span class="line"></span><br><span class="line">create_specification:</span><br><span class="line">    [<span class="keyword">DEFAULT</span>] <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> [=] charset_name</span><br><span class="line">  | [<span class="keyword">DEFAULT</span>] <span class="keyword">COLLATE</span> [=] collation_name</span><br></pre></td></tr></table></figure>
<p>该CHARACTER SET子句指定默认的数据库字符集。该COLLATE子句指定默认的数据库排序规则。而查看所有支持的字符集可使用：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="built_in">character</span> <span class="keyword">set</span>;</span><br><span class="line"></span><br><span class="line">+<span class="comment">----------+-----------------------------+---------------------+--------+</span></span><br><span class="line">| Charset  | Description                 | Default collation   | Maxlen |</span><br><span class="line">+<span class="comment">----------+-----------------------------+---------------------+--------+</span></span><br><span class="line">| big5     | Big5 Traditional Chinese    | big5_chinese_ci     |      2 |</span><br><span class="line">| koi8u    | KOI8-U Ukrainian            | koi8u_general_ci    |      1 |</span><br><span class="line">| gb2312   | GB2312 Simplified Chinese   | gb2312_chinese_ci   |      2 |</span><br><span class="line">| gbk      | GBK Simplified Chinese      | gbk_chinese_ci      |      2 |</span><br><span class="line">| utf8     | UTF-8 Unicode               | utf8_general_ci     |      3 |</span><br><span class="line">| utf8mb4  | UTF-8 Unicode               | utf8mb4_general_ci  |      4 |</span><br><span class="line">| cp1251   | Windows Cyrillic            | cp1251_general_ci   |      1 |</span><br><span class="line">| utf16    | UTF-16 Unicode              | utf16_general_ci    |      4 |</span><br><span class="line">+<span class="comment">----------+-----------------------------+---------------------+--------+</span></span><br></pre></td></tr></table></figure></p>
<p>如：创建一个名为ygq的数据库<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> ygq <span class="built_in">character</span> <span class="keyword">set</span> utf8;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br></pre></td></tr></table></figure></p>
<h2 id="create-table"><a href="#create-table" class="headerlink" title="create table"></a>create table</h2><p>创建数据表的选项和参数极多，这里只列举一小部分，具体的可自行使用help查看。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">help</span> <span class="keyword">create</span> <span class="keyword">table</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">TEMPORARY</span>] <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] tbl_name</span><br><span class="line">    (create_definition,...)</span><br><span class="line">    [table_options]</span><br><span class="line"><span class="keyword">OR</span></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">TEMPORARY</span>] <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] tbl_name</span><br><span class="line">    &#123; <span class="keyword">LIKE</span> old_tbl_name | (<span class="keyword">LIKE</span> old_tbl_name) &#125;</span><br><span class="line"></span><br><span class="line">#其中</span><br><span class="line">create_definition:</span><br><span class="line">    col_name column_definition</span><br><span class="line">    &#123;<span class="keyword">INDEX</span>|<span class="keyword">KEY</span>&#125; [index_name] [index_type] (index_col_name,...)          </span><br><span class="line">    [index_option] ...</span><br><span class="line"></span><br><span class="line">column_definition:</span><br><span class="line">    data_type [<span class="keyword">NOT</span> <span class="literal">NULL</span> | <span class="literal">NULL</span>] [<span class="keyword">DEFAULT</span> default_value]</span><br><span class="line">      [AUTO_INCREMENT] [<span class="keyword">UNIQUE</span> [<span class="keyword">KEY</span>] | [PRIMARY] <span class="keyword">KEY</span>]</span><br><span class="line">      [<span class="keyword">COMMENT</span> <span class="string">'string'</span>]</span><br><span class="line">      [COLUMN_FORMAT &#123;<span class="keyword">FIXED</span>|DYNAMIC|<span class="keyword">DEFAULT</span>&#125;]</span><br><span class="line">      [<span class="keyword">STORAGE</span> &#123;DISK|<span class="keyword">MEMORY</span>|<span class="keyword">DEFAULT</span>&#125;]</span><br><span class="line">      [reference_definition]</span><br><span class="line"></span><br><span class="line">index_col_name:</span><br><span class="line">    col_name [(<span class="keyword">length</span>)] [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>]</span><br><span class="line"></span><br><span class="line">index_type:</span><br><span class="line">    <span class="keyword">USING</span> &#123;BTREE | <span class="keyword">HASH</span>&#125;</span><br><span class="line"></span><br><span class="line">index_option:</span><br><span class="line">    KEY_BLOCK_SIZE [=] <span class="keyword">value</span></span><br><span class="line">  | index_type</span><br><span class="line">  | <span class="keyword">WITH</span> PARSER parser_name</span><br><span class="line">  | <span class="keyword">COMMENT</span> <span class="string">'string'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">table_option:</span><br><span class="line">    <span class="keyword">ENGINE</span> [=] engine_name</span><br><span class="line">  | AUTO_INCREMENT [=] <span class="keyword">value</span></span><br><span class="line">  | AVG_ROW_LENGTH [=] <span class="keyword">value</span></span><br><span class="line">  | [<span class="keyword">DEFAULT</span>] <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> [=] charset_name</span><br><span class="line">  | <span class="keyword">CHECKSUM</span> [=] &#123;<span class="number">0</span> | <span class="number">1</span>&#125;</span><br><span class="line">  | [<span class="keyword">DEFAULT</span>] <span class="keyword">COLLATE</span> [=] collation_name</span><br><span class="line">  | <span class="keyword">COMMENT</span> [=] <span class="string">'string'</span></span><br><span class="line">  | <span class="keyword">CONNECTION</span> [=] <span class="string">'connect_string'</span></span><br><span class="line">  | <span class="keyword">DATA</span> <span class="keyword">DIRECTORY</span> [=] <span class="string">'absolute path to directory'</span></span><br><span class="line">  | DELAY_KEY_WRITE [=] &#123;<span class="number">0</span> | <span class="number">1</span>&#125;</span><br><span class="line">  | <span class="keyword">INDEX</span> <span class="keyword">DIRECTORY</span> [=] <span class="string">'absolute path to directory'</span></span><br><span class="line">  | INSERT_METHOD [=] &#123; <span class="keyword">NO</span> | <span class="keyword">FIRST</span> | <span class="keyword">LAST</span> &#125;</span><br><span class="line">  | KEY_BLOCK_SIZE [=] <span class="keyword">value</span></span><br><span class="line">  | MAX_ROWS [=] <span class="keyword">value</span></span><br><span class="line">  | MIN_ROWS [=] <span class="keyword">value</span></span><br><span class="line">  | PACK_KEYS [=] &#123;<span class="number">0</span> | <span class="number">1</span> | <span class="keyword">DEFAULT</span>&#125;</span><br><span class="line">  | <span class="keyword">PASSWORD</span> [=] <span class="string">'string'</span></span><br><span class="line">  | ROW_FORMAT [=] &#123;<span class="keyword">DEFAULT</span>|DYNAMIC|<span class="keyword">FIXED</span>|COMPRESSED|REDUNDANT|<span class="keyword">COMPACT</span>&#125;</span><br><span class="line">  | <span class="keyword">TABLESPACE</span> tablespace_name [<span class="keyword">STORAGE</span> &#123;DISK|<span class="keyword">MEMORY</span>|<span class="keyword">DEFAULT</span>&#125;]</span><br></pre></td></tr></table></figure></p>
<p>如创建一个数据表：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> ygq_tb(</span><br><span class="line">    -&gt; <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">8</span>) <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">    -&gt; <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">''</span> <span class="keyword">comment</span> <span class="string">'姓名'</span>,</span><br><span class="line">    -&gt; age <span class="built_in">int</span>(<span class="number">2</span>) <span class="literal">null</span>,</span><br><span class="line">    -&gt; primary <span class="keyword">key</span> (<span class="keyword">id</span>),</span><br><span class="line">    -&gt; <span class="keyword">index</span> (<span class="keyword">name</span>),</span><br><span class="line">    -&gt; <span class="keyword">index</span> my_multi (<span class="keyword">name</span>,age)</span><br><span class="line">    -&gt; ) <span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">charset</span>=utf8;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure></p>
<h2 id="create-user"><a href="#create-user" class="headerlink" title="create user"></a>create user</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">help</span> <span class="keyword">create</span> <span class="keyword">user</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> user_specification</span><br><span class="line">    [, user_specification] ...</span><br><span class="line"></span><br><span class="line">user_specification:</span><br><span class="line">    <span class="keyword">user</span></span><br><span class="line">    [</span><br><span class="line">        <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> [<span class="keyword">PASSWORD</span>] <span class="string">'password'</span></span><br><span class="line">      | <span class="keyword">IDENTIFIED</span> <span class="keyword">WITH</span> auth_plugin [<span class="keyword">AS</span> <span class="string">'auth_string'</span>]</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
<p>如创建一个新用户：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#此时用户ygq的密码是被加密存放的</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> ygq <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">#可以使用新用户登录</span><br><span class="line">$ mysql -uygq -p123456</span><br></pre></td></tr></table></figure></p>
<p>也可以给改用户相关授权，具体的授权grant用法会在下面详细讲到。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 将ygq_db这个数据库的所有权限都给ygq用户</span><br><span class="line"><span class="keyword">grant</span> all <span class="keyword">on</span> ygq_db.* <span class="keyword">to</span> ygq;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<h2 id="create-index"><a href="#create-index" class="headerlink" title="create index"></a>create index</h2><p>这个命令可以给已存在的数据表添加新索引。虽然创建表的时候也能添加索引，但由于最初创建表的时候可能并不能考虑周全，随着业务发展，表结构也许发生了变化，此时就可能要给已存在的表添加新索引。</p>
<p>具体的索引类型以及索引相关知识将会在后面的博客中更详细讲到，这里只讲创建索引的一些基本语法，不涉及原理。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">help</span> <span class="keyword">create</span> <span class="keyword">index</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">ONLINE</span>|<span class="keyword">OFFLINE</span>] [<span class="keyword">UNIQUE</span>|FULLTEXT|SPATIAL] <span class="keyword">INDEX</span> index_name</span><br><span class="line">    [index_type]</span><br><span class="line">    <span class="keyword">ON</span> tbl_name (index_col_name,...)</span><br><span class="line">    [index_option] ...</span><br><span class="line"></span><br><span class="line">index_col_name:</span><br><span class="line">    col_name [(<span class="keyword">length</span>)] [<span class="keyword">ASC</span> | <span class="keyword">DESC</span>]</span><br><span class="line"></span><br><span class="line">index_type:</span><br><span class="line">    <span class="keyword">USING</span> &#123;BTREE | <span class="keyword">HASH</span>&#125;</span><br><span class="line"></span><br><span class="line">index_option:</span><br><span class="line">    KEY_BLOCK_SIZE [=] <span class="keyword">value</span></span><br><span class="line">  | index_type</span><br><span class="line">  | <span class="keyword">WITH</span> PARSER parser_name</span><br><span class="line">  | <span class="keyword">COMMENT</span> <span class="string">'string'</span></span><br></pre></td></tr></table></figure></p>
<p>如,在ygq_tb表上的name新建名字为name的普通索引:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">index</span> <span class="keyword">name</span> <span class="keyword">on</span> ygq_tb(<span class="keyword">name</span>);</span><br></pre></td></tr></table></figure></p>
<h1 id="alter命令"><a href="#alter命令" class="headerlink" title="alter命令"></a>alter命令</h1><p>alter命令主要有以下子命令：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">EVENT</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">FUNCTION</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">LOGFILE</span> <span class="keyword">GROUP</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">PROCEDURE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">SERVER</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLESPACE</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span></span><br></pre></td></tr></table></figure></p>
<h2 id="alter-database"><a href="#alter-database" class="headerlink" title="alter database"></a>alter database</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> &#123;<span class="keyword">DATABASE</span> | <span class="keyword">SCHEMA</span>&#125; [db_name]</span><br><span class="line">    alter_specification ...</span><br><span class="line"><span class="keyword">ALTER</span> &#123;<span class="keyword">DATABASE</span> | <span class="keyword">SCHEMA</span>&#125; db_name</span><br><span class="line">    <span class="keyword">UPGRADE</span> <span class="keyword">DATA</span> <span class="keyword">DIRECTORY</span> <span class="keyword">NAME</span></span><br><span class="line"></span><br><span class="line">alter_specification:</span><br><span class="line">    [<span class="keyword">DEFAULT</span>] <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> [=] charset_name</span><br><span class="line">  | [<span class="keyword">DEFAULT</span>] <span class="keyword">COLLATE</span> [=] collation_name</span><br></pre></td></tr></table></figure>
<p>如：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> ygq_db <span class="keyword">charset</span> utf8;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<h2 id="alter-table"><a href="#alter-table" class="headerlink" title="alter table"></a>alter table</h2><p>修改表的语法和选项特别多，这里只列举一部分，可自行help查看帮助信息。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">help</span> <span class="keyword">alter</span> <span class="keyword">table</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name</span><br><span class="line">    [alter_specification [, alter_specification] ...]</span><br><span class="line">    [partition_options]</span><br><span class="line"></span><br><span class="line">alter_specification:</span><br><span class="line">    table_options</span><br><span class="line">  | <span class="keyword">ADD</span> [<span class="keyword">COLUMN</span>] col_name column_definition                     <span class="comment">--添加字段</span></span><br><span class="line">        [<span class="keyword">FIRST</span> | <span class="keyword">AFTER</span> col_name ]</span><br><span class="line"></span><br><span class="line">  | <span class="keyword">ADD</span> [<span class="keyword">UNIQUE</span>] &#123;<span class="keyword">INDEX</span>|<span class="keyword">KEY</span>&#125; [index_name]</span><br><span class="line">        [index_type] (index_col_name,...) [index_option] ...    <span class="comment">--添加索引</span></span><br><span class="line"></span><br><span class="line">  | <span class="keyword">ALTER</span> [<span class="keyword">COLUMN</span>] col_name &#123;<span class="keyword">SET</span> <span class="keyword">DEFAULT</span> literal | <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span>&#125;<span class="comment">--修改默认值</span></span><br><span class="line"></span><br><span class="line">  | <span class="keyword">CHANGE</span> [<span class="keyword">COLUMN</span>] old_col_name new_col_name column_definition <span class="comment">--修改字段</span></span><br><span class="line">        [<span class="keyword">FIRST</span>|<span class="keyword">AFTER</span> col_name]</span><br><span class="line">  | <span class="keyword">MODIFY</span> [<span class="keyword">COLUMN</span>] col_name column_definition</span><br><span class="line">        [<span class="keyword">FIRST</span> | <span class="keyword">AFTER</span> col_name]</span><br><span class="line">        </span><br><span class="line">  | <span class="keyword">DROP</span> [<span class="keyword">COLUMN</span>] col_name                                      <span class="comment">--删除字段</span></span><br><span class="line">  | <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>                                            <span class="comment">--删除主键</span></span><br><span class="line">  | <span class="keyword">DROP</span> &#123;<span class="keyword">INDEX</span>|<span class="keyword">KEY</span>&#125; index_name                                 <span class="comment">--删除索引</span></span><br><span class="line"></span><br><span class="line">  | <span class="keyword">RENAME</span> [<span class="keyword">TO</span>|<span class="keyword">AS</span>] new_tbl_name                                 <span class="comment">--修改表名</span></span><br><span class="line">   </span><br><span class="line">  | <span class="keyword">CONVERT</span> <span class="keyword">TO</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> charset_name [<span class="keyword">COLLATE</span> collation_name]</span><br></pre></td></tr></table></figure></p>
<p>如，修改ygq_tb表名：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ygq_tb <span class="keyword">rename</span> ygq;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure></p>
<p>修改字符集：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ygq <span class="keyword">convert</span> <span class="keyword">to</span> <span class="keyword">charset</span> utf8;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure></p>
<p>在name字段后面添加字段:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ygq <span class="keyword">add</span> gender tinyint <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="number">0</span> <span class="keyword">after</span> <span class="keyword">name</span>;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ygq <span class="keyword">add</span> create_time <span class="keyword">timestamp</span>;</span><br></pre></td></tr></table></figure></p>
<p>修改字段：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ygq <span class="keyword">modify</span> <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ygq <span class="keyword">modify</span> age <span class="built_in">int</span>(<span class="number">4</span>) <span class="keyword">default</span> <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改字段名，修改字段名的时候，除了修改名字之外，必须至少带其他一个参数，否则会报错</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ygq <span class="keyword">change</span> age n_age <span class="built_in">int</span>(<span class="number">4</span>) <span class="keyword">default</span> <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除字段</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ygq <span class="keyword">drop</span> age;</span><br></pre></td></tr></table></figure></p>
<p>关于索引的修改：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--增加[唯一]索引</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ygq <span class="keyword">add</span> [<span class="keyword">unique</span>] <span class="keyword">index</span>(create_time);</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除索引</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ygq <span class="keyword">drop</span> <span class="keyword">index</span> create_time;</span><br></pre></td></tr></table></figure></p>
<h1 id="grant命令"><a href="#grant命令" class="headerlink" title="grant命令"></a>grant命令</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">help</span> <span class="keyword">grant</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span></span><br><span class="line">    priv_type [(column_list)]</span><br><span class="line">      [, priv_type [(column_list)]] ...</span><br><span class="line">    <span class="keyword">ON</span> [object_type] priv_level</span><br><span class="line">    <span class="keyword">TO</span> user_specification [, user_specification] ...</span><br><span class="line">    [REQUIRE &#123;<span class="keyword">NONE</span> | ssl_option [[<span class="keyword">AND</span>] ssl_option] ...&#125;]</span><br><span class="line">    [<span class="keyword">WITH</span> with_option ...]</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> PROXY <span class="keyword">ON</span> user_specification</span><br><span class="line">    <span class="keyword">TO</span> user_specification [, user_specification] ...</span><br><span class="line">    [<span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>]</span><br><span class="line"></span><br><span class="line">priv_type:</span><br><span class="line">  | <span class="keyword">SELECT</span> | <span class="keyword">DELETE</span> | <span class="keyword">CREATE</span> | <span class="keyword">DROP</span> | <span class="keyword">UPDATE</span> | ALL ... </span><br><span class="line"></span><br><span class="line">object_type:</span><br><span class="line">    <span class="keyword">TABLE</span></span><br><span class="line">  | <span class="keyword">FUNCTION</span></span><br><span class="line">  | <span class="keyword">PROCEDURE</span></span><br><span class="line"></span><br><span class="line">priv_level:</span><br><span class="line">    *</span><br><span class="line">  | *.*</span><br><span class="line">  | db_name.*</span><br><span class="line">  | db_name.tbl_name</span><br><span class="line">  | tbl_name</span><br><span class="line">  | db_name.routine_name</span><br><span class="line"></span><br><span class="line">user_specification:</span><br><span class="line">    <span class="keyword">user</span></span><br><span class="line">    [</span><br><span class="line">        <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> [<span class="keyword">PASSWORD</span>] <span class="string">'password'</span></span><br><span class="line">      | <span class="keyword">IDENTIFIED</span> <span class="keyword">WITH</span> auth_plugin [<span class="keyword">AS</span> <span class="string">'auth_string'</span>]</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
<p>给已存在的用户授权<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> all <span class="keyword">on</span> ygq_db.* <span class="keyword">to</span> ygq;</span><br></pre></td></tr></table></figure></p>
<p>新创建用户并直接授权：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> all <span class="keyword">on</span> *.* <span class="keyword">to</span> ygqq <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span>;</span><br></pre></td></tr></table></figure></p>
<p>修改完权限后要flush一下使之生效:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/26/web架构/centos6-9完整编译安装LAMP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ygqqq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="for the dream">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/26/web架构/centos6-9完整编译安装LAMP/" itemprop="url">centos6.9完整编译安装LAMP</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-26T00:00:00+08:00">
                2017-09-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web架构/" itemprop="url" rel="index">
                    <span itemprop="name">web架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="编译安装http2-4-29"><a href="#编译安装http2-4-29" class="headerlink" title="编译安装http2.4.29"></a>编译安装http2.4.29</h1><h2 id="下载源码包"><a href="#下载源码包" class="headerlink" title="下载源码包"></a>下载源码包</h2><p>下载最新httpd源码包:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.shuosc.org/apache//httpd/httpd-2.4.29.tar.gz</span><br><span class="line"></span><br><span class="line">tar xf httpd/httpd-2.4.29.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>下载apr源码包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.tuna.tsinghua.edu.cn/apache//apr/apr-1.6.3.tar.gz</span><br><span class="line"></span><br><span class="line">tar xf apr-1.6.3.tar.gz</span><br><span class="line"></span><br><span class="line">wget http://mirrors.tuna.tsinghua.edu.cn/apache//apr/apr-util-1.6.1.tar.gz</span><br><span class="line"></span><br><span class="line">tar xf apr-util-1.6.1.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>将apr包解压到httpd源码包的<code>srclib</code>目录，注意apr名字不能带版本号。</p>
<blockquote>
<p>be sure the directory names do not have version numbers; for example, the APR distribution must be under /httpd_source_tree_root/srclib/apr/</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv apr-1.6.3 ./httpd-2.4.29/srclib/apr</span><br><span class="line"></span><br><span class="line">mv apr-util-1.6.1 ./httpd-2.4.29/srclib/apr-util</span><br></pre></td></tr></table></figure>
<p>这种方式就是将apr、apr-util作为httpd模块一起编译安装，也可以单独编译安装apr和apr-util，然后在编译安装时指定apr和apr-util的路径。这里只演示一起编译安装的，毕竟这种方式毕竟简单省事。</p>
<h2 id="一些开发包安装"><a href="#一些开发包安装" class="headerlink" title="一些开发包安装"></a>一些开发包安装</h2><p>安装开发包组：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall <span class="string">'Development tools'</span></span><br><span class="line"><span class="comment"># 如果是centos6还要安装下面的包组</span></span><br><span class="line">yum groupinstall <span class="string">'Server Platform Development'</span></span><br></pre></td></tr></table></figure></p>
<p>由于启用了rewrite模块，所以会用到pcre包；另外，apr编译安装时，也会需要expat包，所以都要提前安装，不然编译时会报错。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre-devel expat-devel</span><br></pre></td></tr></table></figure></p>
<h2 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> httpd-2.4.29</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/apache2  \  <span class="comment">#设置安装路径，默认安装路径就是/usr/local/apache2</span></span><br><span class="line">            --with-include-apr \            <span class="comment">#指明一起编译安装apr，会自动去srclib目录下找apr和apr-util源码</span></span><br><span class="line">            --<span class="built_in">enable</span>-mpms-shared=all  \     <span class="comment">#指明安装所有mpm模块</span></span><br><span class="line">            --<span class="built_in">enable</span>-mods-shared=most \     <span class="comment">#指明编译安装大多数常用模块</span></span><br><span class="line">            --<span class="built_in">enable</span>-ssl \                  <span class="comment">#指明启用ssl模块</span></span><br><span class="line">            --<span class="built_in">enable</span>-so                     <span class="comment">#启动模块动态装卸载</span></span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h2 id="设置开机自启动"><a href="#设置开机自启动" class="headerlink" title="设置开机自启动"></a>设置开机自启动</h2><p>这里的设置centos6和7都支持：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/apache2/bin/apachectl /etc/init.d/httpd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑/etc/init.d/httpd，使之适应chkconfig格式，在文件头部加入如下信息:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># chkconfig: 345 10 79</span></span><br><span class="line"><span class="comment"># description: Apache</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"></span><br><span class="line">chkconfig --add httpd</span><br><span class="line">chkconfig httpd on</span><br></pre></td></tr></table></figure></p>
<h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"export PATH=/usr/local/apache2/bin:<span class="variable">$PATH</span>"</span> &gt; /etc/profile.d/apache.sh</span><br><span class="line"></span><br><span class="line">chmod +x /etc/profile.d/apache.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile.d/apache.sh</span><br></pre></td></tr></table></figure>
<h1 id="编译安装MariaDB-10-1-30"><a href="#编译安装MariaDB-10-1-30" class="headerlink" title="编译安装MariaDB 10.1.30"></a>编译安装MariaDB 10.1.30</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>下载源码包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.mariadb.org/interstitial/mariadb-10.1.30/<span class="built_in">source</span>/mariadb-10.1.30.tar.gz/from/http%3A//mirrors.tuna.tsinghua.edu.cn/mariadb/</span><br></pre></td></tr></table></figure></p>
<p>创建mysql用户和组，并新建存放mysql数据的目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /mydata/data</span><br><span class="line">groupadd -r mysql</span><br><span class="line">useradd -g mysql -r -d /mydata/data</span><br><span class="line">chown -R mysql:mysql /mydata/data</span><br></pre></td></tr></table></figure></p>
<p>编译安装mysql需要cmake<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install cmake</span><br></pre></td></tr></table></figure></p>
<h2 id="编译安装-1"><a href="#编译安装-1" class="headerlink" title="编译安装"></a>编译安装</h2><p>这个过程比较慢，等待过程中可以去准备安装php<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tar xf mariadb-10.1.30.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> mariadb-10.1.30</span><br><span class="line"></span><br><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/usr/<span class="built_in">local</span>/mysql -DMYSQL_DATADIR=/mydata/data/ \</span><br><span class="line">-DSYSCONFDIR=/etc -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_ARCHIVE_STPRAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 -DWIYH_READLINE=1 -DWIYH_SSL=system -DVITH_ZLIB=system \</span><br><span class="line">-DWITH_LOBWRAP=0 -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci  </span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></p>
<h2 id="安装后的相关配置"><a href="#安装后的相关配置" class="headerlink" title="安装后的相关配置"></a>安装后的相关配置</h2><p>初始化数据库<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql </span><br><span class="line">chown -R mysql:mysql *</span><br><span class="line"></span><br><span class="line">scripts/mysql_install_db --datadir=/mydata/data --user=mysql</span><br><span class="line"></span><br><span class="line">chown -R root *</span><br></pre></td></tr></table></figure></p>
<p>提供mysql相关脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql </span><br><span class="line">cp support-files/mysql.server  /etc/rc.d/init.d/mysqld</span><br><span class="line">chmod +x /etc/rc.d/init.d/mysqld </span><br><span class="line"><span class="comment">#设置mysql为系统服务，并开机自启动</span></span><br><span class="line">chkconfig --add mysqld   </span><br><span class="line">chkconfig mysqld on</span><br></pre></td></tr></table></figure></p>
<p>提供配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql </span><br><span class="line">cp support-files/my-large.cnf  /etc/my.cnf  </span><br><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line"><span class="comment">#myssqld配置段中添加如下</span></span><br><span class="line">[mysqld]  </span><br><span class="line">datadir = /mydata/data</span><br></pre></td></tr></table></figure></p>
<p>配置环境变量，库文件，头文件，man手册<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置环境变量 </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH=/usr/local/mysql/bin:$PATH'</span> &gt; /etc/profile.d/mysql.sh  </span><br><span class="line"><span class="comment">#读取配置文件使之立即生效</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile.d/mysql.sh</span><br><span class="line"><span class="comment">#提供库文件  </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'/usr/local/mysql/lib'</span> &gt; /etc/ld.so.conf.d/mysql.conf  </span><br><span class="line"><span class="comment">#提供头文件  </span></span><br><span class="line">ln -sv /usr/<span class="built_in">local</span>/include /usr/include/mysql  </span><br><span class="line"><span class="comment">#提供man手册  </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'MANPATH /usr/local/mysql'</span> &gt;&gt; /etc/man.config  </span><br><span class="line"><span class="comment">#让man手册立刻生效为最新 </span></span><br><span class="line">man -M /usr/<span class="built_in">local</span>/mysql/man mysqld</span><br></pre></td></tr></table></figure></p>
<p>启动服务，连接MariaDB服务器<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service mysqld start </span><br><span class="line"></span><br><span class="line"><span class="comment">#建议运行mysql自带的安全安装脚本进行用户初始化，比如加密码等等，也可以自行修改</span></span><br><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure></p>
<h1 id="编译安装php-5-6-33"><a href="#编译安装php-5-6-33" class="headerlink" title="编译安装php-5.6.33"></a>编译安装php-5.6.33</h1><h2 id="编译安装-2"><a href="#编译安装-2" class="headerlink" title="编译安装"></a>编译安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">wget http://ca1.php.net/get/php-5.6.33.tar.xz/from/this/mirror</span><br><span class="line"></span><br><span class="line">mv mirror php-5.6.33.tar.xz</span><br><span class="line"></span><br><span class="line">tar xf php-5.6.33.tar.xz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> php-5.6.33</span><br><span class="line"></span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/php \       <span class="comment">#指定php安装路径</span></span><br><span class="line">--with-mysql=/usr/<span class="built_in">local</span>/mysql \             <span class="comment">#指定mysql的安装路径</span></span><br><span class="line">--with-openssl --with-mysqli=/usr/<span class="built_in">local</span>/mysql/bin/mysql_config \    </span><br><span class="line">--<span class="built_in">enable</span>-mbstring --with-freetype-dir --with-jpeg-dir --with-png-dir \</span><br><span class="line">--with-zlib --with-libxml-dir=/usr --<span class="built_in">enable</span>-xml  --<span class="built_in">enable</span>-sockets \</span><br><span class="line">--with-apxs2=/usr/<span class="built_in">local</span>/apache2/bin/apxs \  <span class="comment">#此项非常重要，指明将php作为apache模块安装，并指明apache的路径</span></span><br><span class="line">--with-mcrypt  --with-config-file-path=/etc \</span><br><span class="line">--with-config-file-scan-dir=/etc/php.d --with-bz2  \</span><br><span class="line">--<span class="built_in">enable</span>-maintainer-zts     <span class="comment">#此项很重要，是为了支持worker和event两张mpm</span></span><br></pre></td></tr></table></figure>
<p>如果使用PHP5.3以上版本，为了链接MySQL数据库，可以指定mysqlnd，这样在本机就不需要先安装MySQL或MySQL开发包了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#可将前面选项中对应的替换成如下：</span></span><br><span class="line">--with-mysql=mysqlnd --with-pdo-mysql=mysqlnd --with-mysqli=mysqlnd</span><br></pre></td></tr></table></figure></p>
<p>如果一切正常的话:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line">make <span class="built_in">test</span>       </span><br><span class="line">make intall</span><br></pre></td></tr></table></figure></p>
<p>为php提供配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#源码包里有官方配置好的配置文件</span></span><br><span class="line">cp php.ini-production /etc/php.ini</span><br></pre></td></tr></table></figure></p>
<h2 id="使apache支持php"><a href="#使apache支持php" class="headerlink" title="使apache支持php"></a>使apache支持php</h2><p>编辑apache配置文件<code>httpd.conf</code>，添加如下两行信息：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php  .php</span><br><span class="line">AddType application/x-httpd-php-source  .phps</span><br></pre></td></tr></table></figure></p>
<p>并且要确保apache加载了php模块<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadModule php5_module        modules/libphp5.so</span><br></pre></td></tr></table></figure></p>
<p>而后重新启动httpd，或让其重新载入配置文件即可测试php是否已经可以正常使用。如果一切正常，那么此时apache就能支持php，并且可随时切换prefork、worker、event三种模式，而且已经能连接mysql数据库了。</p>
<h2 id="将php安装为php-fpm模式"><a href="#将php安装为php-fpm模式" class="headerlink" title="将php安装为php-fpm模式"></a>将php安装为php-fpm模式</h2><p>其余步骤都一样，包括apache和mysql的安装，只是在编译安装php时候的参数稍有不同，并且之后的apache配置也要修改下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">./configure \       </span><br><span class="line">--prefix=/usr/<span class="built_in">local</span>/php \</span><br><span class="line">--with-config-file-path=/usr/<span class="built_in">local</span>/php/etc \</span><br><span class="line">--<span class="built_in">enable</span>-inline-optimization \</span><br><span class="line">--<span class="built_in">disable</span>-debug \</span><br><span class="line">--<span class="built_in">disable</span>-rpath \</span><br><span class="line">--<span class="built_in">enable</span>-shared \</span><br><span class="line">--<span class="built_in">enable</span>-opcache \</span><br><span class="line">--<span class="built_in">enable</span>-fpm \</span><br><span class="line">--with-mysql=/usr/<span class="built_in">local</span>/mysql \</span><br><span class="line">--with-mysqli=/usr/<span class="built_in">local</span>/mysql/bin/mysql_config \</span><br><span class="line">--with-pdo-mysql=/usr/<span class="built_in">local</span>/mysql \</span><br><span class="line">--with-gettext \</span><br><span class="line">--<span class="built_in">enable</span>-mbstring \</span><br><span class="line">--with-iconv \</span><br><span class="line">--with-mcrypt \</span><br><span class="line">--with-mhash \</span><br><span class="line">--with-openssl \</span><br><span class="line">--<span class="built_in">enable</span>-bcmath \</span><br><span class="line">--<span class="built_in">enable</span>-soap \</span><br><span class="line">--with-libxml-dir \</span><br><span class="line">--<span class="built_in">enable</span>-pcntl \</span><br><span class="line">--<span class="built_in">enable</span>-shmop \</span><br><span class="line">--<span class="built_in">enable</span>-sysvmsg \</span><br><span class="line">--<span class="built_in">enable</span>-sysvsem \</span><br><span class="line">--<span class="built_in">enable</span>-sysvshm \</span><br><span class="line">--<span class="built_in">enable</span>-sockets \</span><br><span class="line">--with-curl \</span><br><span class="line">--with-zlib \</span><br><span class="line">--<span class="built_in">enable</span>-zip \</span><br><span class="line">--with-bz2 \</span><br><span class="line">--with-gd \</span><br><span class="line">--with-freetype-dir \</span><br><span class="line">--with-jpeg-dir \</span><br><span class="line">--with-png-dir</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></p>
<p>一些安装过程中可能需要的包<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">libxml2-devel bzip2-devel libcurl-devel</span><br><span class="line">libmcrypt-devel mhash-devel</span><br></pre></td></tr></table></figure></p>
<h2 id="安装后的一些配置"><a href="#安装后的一些配置" class="headerlink" title="安装后的一些配置"></a>安装后的一些配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cp php.ini-production /usr/<span class="built_in">local</span>/php/etc/php.ini</span><br><span class="line"></span><br><span class="line">cp /usr/<span class="built_in">local</span>/php/etc/php-fpm.conf.default /usr/<span class="built_in">local</span>/php/etc/php-fpm.conf</span><br><span class="line"></span><br><span class="line">cp sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm</span><br><span class="line">chmod +x /etc/init.d/php-fpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#将php-fpm设置为系统服务</span></span><br><span class="line">chkconfig --add php-fpm</span><br><span class="line">chkconfig php-fpm on</span><br><span class="line"><span class="comment">#开启php-fpm</span></span><br><span class="line">service php-fpm start</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看php-fpm进程</span></span><br><span class="line">ps -ef|grep php</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看php-fpm监听端口</span></span><br><span class="line">ss -tnl | grep 9000</span><br></pre></td></tr></table></figure>
<h2 id="配置apache访问PHP"><a href="#配置apache访问PHP" class="headerlink" title="配置apache访问PHP"></a>配置apache访问PHP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开启以下模块</span></span><br><span class="line">LoadModule proxy_module modeles/mod_proxy.so</span><br><span class="line">LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑httpd.conf文件</span></span><br><span class="line">AddType application/x-httpd-php .php  </span><br><span class="line">AddType application/x-httpd-php-source .phps</span><br><span class="line"></span><br><span class="line">ProxyRequests Off   <span class="comment">###关闭正向代理，开启下行的反向代理</span></span><br><span class="line">ProxyPassMatch ^/(.*\.php)$ fcgi://127.0.0.1:9000/usr/<span class="built_in">local</span>/apache/htdocs/<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#重启apache</span></span><br><span class="line">service restart httpd</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/25/linux基础/文本编辑工具-sed命令详解与应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ygqqq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="for the dream">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/25/linux基础/文本编辑工具-sed命令详解与应用/" itemprop="url">文本编辑工具:sed命令详解与应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-25T00:00:00+08:00">
                2017-09-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux基础/" itemprop="url" rel="index">
                    <span itemprop="name">linux基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>sed是一个流式编辑器程序，它读取输入流(可以是文件、标准输入)的每一行放进模式空间(pattern space)，然后对模式空间中的行进行模式匹配，如果能匹配上则使用sed程序内部的命令进行处理。</p>
<p>处理结束后，从模式空间中输出(默认)出去，并清空模式空间，随后再从输入流中读取下一行到模式空间中进行相同的操作，直到输入流中的所有行都处理完成。由此可见，sed是一个循环一个循环处理内容的。</p>
<p>这是sed的一个循环的过程：</p>
<ol>
<li>读取输入流的一行到模式空间。</li>
<li>对模式空间中的内容进行匹配和处理。匹配就是定界，处理就是命令，如p、d等</li>
<li>自动输出模式空间内容。如果使用了-n，就不会自动输出了</li>
<li>清空模式空间内容。</li>
<li>读取输入流的下一行到模式空间。</li>
</ol>
<p>上述整个循环过程中，第2步是我们写sed命令所修改的地方，其余的几个步骤，通过命令行无法改变。但是，sed有几个命令和选项能改变第3、4步的行为，使其输出总是输出空内容或无法清空模式空间。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'Address&#123;cmd1;cmd2;cmd3...&#125;'</span> input-file</span><br><span class="line"></span><br><span class="line"><span class="comment">#命令可以有多个，多个命令用;隔开。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行流程大致如下：</span></span><br><span class="line"><span class="keyword">for</span> ((line=1;line&lt;=last_line_num;++line))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> <span class="variable">$line</span> to pattern_space;</span><br><span class="line">    <span class="keyword">while</span> pattern_space is not null</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        execute cmd1 <span class="keyword">in</span> SCRIPT;</span><br><span class="line">        execute cmd2 <span class="keyword">in</span> SCRIPT;</span><br><span class="line">        execute cmd3 <span class="keyword">in</span> SCRIPT;</span><br><span class="line">        ……</span><br><span class="line">        auto_print;</span><br><span class="line">        remove_pattern_space;</span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h2 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sed [OPTION]... <span class="string">'[地址定界]&lt;命令&gt;'</span> [input-file]...</span><br><span class="line">       -n      <span class="comment">#suppress automatic printing of pattern space,只显示匹配到的行</span></span><br><span class="line">       -r      <span class="comment">#使用扩展正则</span></span><br><span class="line">       -i      <span class="comment">#直接修改源文件</span></span><br><span class="line">       -e      <span class="comment">#多个sed表达式</span></span><br></pre></td></tr></table></figure>
<p>sed命令最主要的就是<strong>地址定界</strong>配合相关<strong>命令</strong>来实现文本行编辑，我们先说地址定界。</p>
<h2 id="地址定界"><a href="#地址定界" class="headerlink" title="地址定界"></a>地址定界</h2><p>地址定界有很多种，不指定的话，默认为全文本。也可以具体指定某几行，也可以具体指定步进，也可以根据正则来定界。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">N: 指定行；</span><br><span class="line">$: 最后一行；</span><br><span class="line">/regexp/：任何能够被regexp所匹配到的行；</span><br><span class="line">N,/regexp/：从N行开始，到第一次被/regexp/所匹配到的行结束，中间的所有行；</span><br><span class="line">/regexp1/,/regexp2/：从第一次被/regexp1/匹配到的行开始，到第一次被/regexp2/匹配到的行结束，中间的所有行</span><br><span class="line">N,+n：从N行开始，一直到向下的n行；</span><br><span class="line">first~step：指定起始行，以及步长；</span><br></pre></td></tr></table></figure></p>
<p>相关示例，如：显示全文<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#没指定定界，所以显示全文</span></span><br><span class="line">sed -n <span class="string">'p'</span> /etc/fstab</span><br><span class="line"><span class="comment">#也可以：</span></span><br><span class="line">sed -n <span class="string">'1,$p'</span> /etc/fstab</span><br></pre></td></tr></table></figure></p>
<p>显示所有#号开头，后面跟一个空格，然后后面跟一个单词类字符的行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">'/^#\s\w/p'</span> /etc/fstab</span><br></pre></td></tr></table></figure></p>
<p>显示所有奇数行:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">'1~2p'</span> /etc/fstab</span><br></pre></td></tr></table></figure></p>
<h2 id="编辑命令"><a href="#编辑命令" class="headerlink" title="编辑命令"></a>编辑命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">d: 删除</span><br><span class="line">p: 显示模式空间中的内容</span><br><span class="line">a \text：在行后面追加文本；支持使用\n实现多行追加；</span><br><span class="line">i \text：在行前面插入文本；支持使用\n实现多行插入；</span><br><span class="line">c \text：替换行为单行或多行文本；</span><br><span class="line">w /path/to/somefile: 保存模式空间匹配到的行至指定文件中；</span><br><span class="line">r /path/from/somefile：读取指定文件的文本流至模式空间中匹配到的行的行后；</span><br><span class="line">=: 为模式空间中的行打印行号；</span><br><span class="line">!: 取反条件; 如!d,!p</span><br><span class="line">s///：支持使用其它分隔符，s@@@，s<span class="comment">###；</span></span><br><span class="line">    替换标记：</span><br><span class="line">        g: 行内全局替换；</span><br><span class="line">        p: 显示替换成功的行；</span><br><span class="line">        w /PATH/TO/SOMEFILE：将替换成功的结果保存至指定文件中；</span><br><span class="line"></span><br><span class="line">高级编辑命令：</span><br><span class="line">    h: 把模式空间中的内容覆盖至保持空间中；</span><br><span class="line">    H：把模式空间中的内容追加至保持空间中；</span><br><span class="line">    g: 从保持空间取出数据覆盖至模式空间；</span><br><span class="line">    G：从保持空间取出内容追加至模式空间；</span><br><span class="line">    x: 把模式空间中的内容与保持空间中的内容进行互换；</span><br><span class="line">    n: 读取匹配到的行的下一行至模式空间；</span><br><span class="line">    N：追加匹配到的行的下一行至模式空间；</span><br><span class="line">    d: 删除模式空间中的行；</span><br><span class="line">    D：删除多行模式空间中的所有行；</span><br></pre></td></tr></table></figure>
<h2 id="一些示例"><a href="#一些示例" class="headerlink" title="一些示例"></a>一些示例</h2><p>删除所有空白行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'/^$/d'</span>  /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">sed <span class="string">'/^\s*$/d'</span>  /etc/fstab</span><br></pre></td></tr></table></figure></p>
<p>在所有以大写字母开头的行上面添加一新行，内容为#注释信息：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'/^[A-Z]/i \#注释信息'</span> /etc/fstab</span><br></pre></td></tr></table></figure></p>
<p>删除所有不以大写字母开头的行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">'/^[A-Z]/!d'</span> /etc/fstab</span><br></pre></td></tr></table></figure></p>
<p>显示当前目录下所有.txt结尾文件中以 小写字母组成的单词 开头的行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -nr <span class="string">'/^[a-z]*\b/p'</span> *.txt</span><br></pre></td></tr></table></figure></p>
<p>将文件中所有以大写字母开头，其余字母为小写的单词，前后各加上-,如：  Access，改成-Access-,如果一行出现多次，要全部替换<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用&amp;，可以在后面引用前面匹配到的所有内容</span></span><br><span class="line">sed -r <span class="string">'s/\b[A-Z][a-z]*\b/-&amp;-/g'</span> /etc/fstab</span><br></pre></td></tr></table></figure></p>
<p>将文件中所有以大写字母开头，其余字母为小写的单词，大写字母的前后各加上-,如：  Access，改成-A-ccess,如果一行出现多次，要全部替换<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用\1 \2...可以在后面引用前面匹配到的所对应分组的内容</span></span><br><span class="line">sed -r <span class="string">'s/\b([A-Z])[a-z]*\b/--\1--/g'</span> /etc/fstab</span><br></pre></td></tr></table></figure></p>
<p>将文件中所有以“# 单词”开头中的，空格删除，并显示具体改了哪些行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@ygq ~] sed -nr <span class="string">'s/^(#)\s(\S)/\1\2/p'</span> /etc/fstab </span><br><span class="line"><span class="comment">#/etc/fstab</span></span><br><span class="line"><span class="comment">#Created by anaconda on Thu Nov 30 10:27:49 2017</span></span><br><span class="line"><span class="comment">#Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment">#See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/24/web架构/httpd2-4编译安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ygqqq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="for the dream">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/24/web架构/httpd2-4编译安装/" itemprop="url">centos 6/7 下httpd2.4编译安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-24T00:00:00+08:00">
                2017-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web架构/" itemprop="url" rel="index">
                    <span itemprop="name">web架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="下载源码包"><a href="#下载源码包" class="headerlink" title="下载源码包"></a>下载源码包</h2><p>下载最新httpd源码包:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.shuosc.org/apache//httpd/httpd-2.4.29.tar.gz</span><br><span class="line"></span><br><span class="line">tar xf httpd/httpd-2.4.29.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>下载apr源码包：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.tuna.tsinghua.edu.cn/apache//apr/apr-1.6.3.tar.gz</span><br><span class="line"></span><br><span class="line">tar xf apr-1.6.3.tar.gz</span><br><span class="line"></span><br><span class="line">wget http://mirrors.tuna.tsinghua.edu.cn/apache//apr/apr-util-1.6.1.tar.gz</span><br><span class="line"></span><br><span class="line">tar xf apr-util-1.6.1.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>将apr包解压到httpd源码包的<code>srclib</code>目录，注意apr名字不能带版本号。</p>
<blockquote>
<p>be sure the directory names do not have version numbers; for example, the APR distribution must be under /httpd_source_tree_root/srclib/apr/</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv apr-1.6.3 ./httpd-2.4.29/srclib/apr</span><br><span class="line"></span><br><span class="line">mv apr-util-1.6.1 ./httpd-2.4.29/srclib/apr-util</span><br></pre></td></tr></table></figure>
<p>这种方式就是将apr、apr-util作为httpd模块一起编译安装，也可以单独编译安装apr和apr-util，然后在编译安装时指定apr和apr-util的路径。这里只演示一起编译安装的，毕竟这种方式毕竟简单省事。</p>
<h2 id="一些开发包安装"><a href="#一些开发包安装" class="headerlink" title="一些开发包安装"></a>一些开发包安装</h2><p>安装开发包组：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall <span class="string">'Development tools'</span></span><br><span class="line"><span class="comment"># 如果是centos6还要安装下面的包组</span></span><br><span class="line">yum groupinstall <span class="string">'Server Platform Development'</span></span><br></pre></td></tr></table></figure></p>
<p>由于启用了rewrite模块，所以会用到pcre包；另外，apr编译安装时，也会需要expat包，所以都要提前安装，不然编译时会报错。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre-devel expat-devel</span><br></pre></td></tr></table></figure></p>
<h1 id="编译安装httpd"><a href="#编译安装httpd" class="headerlink" title="编译安装httpd"></a>编译安装httpd</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> httpd-2.4.29</span><br><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/apache2  \  <span class="comment">#设置安装路径，默认安装路径就是/usr/local/apache2</span></span><br><span class="line">            --with-include-apr \            <span class="comment">#指明一起编译安装apr，会自动去srclib目录下找apr和apr-util源码</span></span><br><span class="line">            --<span class="built_in">enable</span>-mpms-shared=all  \     <span class="comment">#指明安装所有mpm模块</span></span><br><span class="line">            --<span class="built_in">enable</span>-mods-shared=most \     <span class="comment">#指明编译安装大多数常用模块</span></span><br><span class="line">            --<span class="built_in">enable</span>-ssl \                  <span class="comment">#指明启用ssl模块</span></span><br><span class="line">            --<span class="built_in">enable</span>-so                     <span class="comment">#启动模块动态装卸载</span></span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h1 id="安装后的相关处理"><a href="#安装后的相关处理" class="headerlink" title="安装后的相关处理"></a>安装后的相关处理</h1><h2 id="设置开机自启动"><a href="#设置开机自启动" class="headerlink" title="设置开机自启动"></a>设置开机自启动</h2><p>这里的设置centos6和7都支持：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/apache2/bin/apachectl /etc/init.d/httpd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#编辑/etc/init.d/httpd，使之适应chkconfig格式，在文件头部加入如下信息:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># chkconfig: 345 10 79</span></span><br><span class="line"><span class="comment"># description: Apache</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"></span><br><span class="line">chkconfig --add httpd</span><br><span class="line">chkconfig httpd on</span><br></pre></td></tr></table></figure></p>
<h2 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"export PATH=/usr/local/apache2/bin:<span class="variable">$PATH</span>"</span> &gt; /etc/profile.d/apache.sh</span><br><span class="line"></span><br><span class="line">chmod +x /etc/profile.d/apache.sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile.d/apache.sh</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/24/openssl/创建私有CA、证书申请、发证详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ygqqq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="for the dream">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/24/openssl/创建私有CA、证书申请、发证详解/" itemprop="url">创建私有CA、证书申请、发证详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-24T00:00:00+08:00">
                2017-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openssl/" itemprop="url" rel="index">
                    <span itemprop="name">openssl</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="创建私有CA"><a href="#创建私有CA" class="headerlink" title="创建私有CA"></a>创建私有CA</h1><p>通过前面的openssl详解的博客我们知道，一个Web服务器想要启用https，就必须有CA签署的证书。</p>
<p>这个证书从哪来呢？可以从一些广为人知的CA机构申请证书，然后将证书文件放到服务器莫目录，在配置apach或ngnix服务器的ssl配置项来启用https。不过这种方式是要收费的。</p>
<p>也可以服务器自己创建私有CA，这种方式是免费的，也能启用https连接，但由于是私有CA，用户在访问我们服务器的https页面时，浏览器会警告说“未受信任的CA证书”，如果用户拒绝信任，那就无法访问页面。如果用户选择信任证书，也能正常访问。</p>
<p>CA原则上可以是任意一台服务器，只要能访问到，但毕竟是私有CA，所以一般都是内网内的某一主机做CA，甚至WEB服务器自身也能做CA，然后自己给自己签证哦。</p>
<p>这里为了方便演示，就采用同一台主机既做CA，又做WEB服务器。只是为了演示才这么做，实际生产环境下，不建议用同一台主机。</p>
<h2 id="CA端的准备工作"><a href="#CA端的准备工作" class="headerlink" title="CA端的准备工作"></a>CA端的准备工作</h2><p>CA端的配置文件：<code>/etc/pki/tls/openssl.cnf</code>，这里面设定了很多CA默认配置，用户也可以自行修改，这里只列举一部分<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[ CA_default ]</span><br><span class="line"></span><br><span class="line">dir             = /etc/pki/CA           <span class="comment"># Where everything is kept</span></span><br><span class="line">certs           = <span class="variable">$dir</span>/certs            <span class="comment"># Where the issued certs are kept</span></span><br><span class="line">crl_dir         = <span class="variable">$dir</span>/crl              <span class="comment"># Where the issued crl are kept</span></span><br><span class="line">database        = <span class="variable">$dir</span>/index.txt        <span class="comment"># database index file.  证书的数据库文件，如果没有这个文件，签署证书时会报错</span></span><br><span class="line"><span class="comment">#unique_subject = no                    # Set to 'no' to allow creation of</span></span><br><span class="line">                                        <span class="comment"># several ctificates with same subject.</span></span><br><span class="line">new_certs_dir   = <span class="variable">$dir</span>/newcerts         <span class="comment"># default place for new certs.</span></span><br><span class="line"></span><br><span class="line">certificate     = <span class="variable">$dir</span>/cacert.pem       <span class="comment"># The CA certificate</span></span><br><span class="line">serial          = <span class="variable">$dir</span>/serial           <span class="comment"># The current serial number 如果没有这个文件，或者文件内容不正确，签署证书时会报错</span></span><br><span class="line">crlnumber       = <span class="variable">$dir</span>/crlnumber        <span class="comment"># the current crl number</span></span><br><span class="line">                                        <span class="comment"># must be commented out to leave a V1 CRL</span></span><br><span class="line">crl             = <span class="variable">$dir</span>/crl.pem          <span class="comment"># The current CRL</span></span><br><span class="line">private_key     = <span class="variable">$dir</span>/private/cakey.pem<span class="comment"># The private key</span></span><br><span class="line">RANDFILE        = <span class="variable">$dir</span>/private/.rand    <span class="comment"># private random number file</span></span><br><span class="line"></span><br><span class="line">x509_extensions = usr_cert              <span class="comment"># The extentions to add to the cert</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Comment out the following two lines for the "traditional"</span></span><br><span class="line"><span class="comment"># (and highly broken) format.</span></span><br><span class="line">name_opt        = ca_default            <span class="comment"># Subject Name options</span></span><br><span class="line">cert_opt        = ca_default            <span class="comment"># Certificate field options</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extension copying option: use with caution.</span></span><br><span class="line"><span class="comment"># copy_extensions = copy</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extensions to add to a CRL. Note: Netscape communicator chokes on V2 CRLs</span></span><br><span class="line"><span class="comment"># so this is commented out by default to leave a V1 CRL.</span></span><br><span class="line"><span class="comment"># crlnumber must also be commented out to leave a V1 CRL.</span></span><br><span class="line"><span class="comment"># crl_extensions        = crl_ext</span></span><br><span class="line"></span><br><span class="line">default_days    = 365                   <span class="comment"># how long to certify for</span></span><br></pre></td></tr></table></figure></p>
<p>准备工作，创建证书数据库和序列号文件:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ygq ~] <span class="built_in">cd</span> /etc/pki/CA</span><br><span class="line">[root@ygq CA] touch index.txt</span><br><span class="line">[root@ygq CA] <span class="built_in">echo</span> 01 &gt; serial</span><br></pre></td></tr></table></figure></p>
<h2 id="CA自签证书"><a href="#CA自签证书" class="headerlink" title="CA自签证书"></a>CA自签证书</h2><p>生成CA自己的私钥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#man genrsa 查看常用选项</span></span><br><span class="line">[root@ygq CA] (<span class="built_in">umask</span> 077; openssl genrsa -out /etc/pki/CA/private/cakey.pem 2048)</span><br></pre></td></tr></table></figure></p>
<p>CA自签证书<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#man req 查看常用选项</span></span><br><span class="line">[root@ygq CA] openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem  -out /etc/pki/CA/cacert.pem</span><br><span class="line">        -new: 生成新证书签署请求；</span><br><span class="line">        -x509: 专用于CA生成自签证书；不带x509的话就是申请签证。只有CA自签才带-x509</span><br><span class="line">        -key: 生成请求时用到的私钥文件；</span><br><span class="line">        -days n：证书的有效期限；</span><br><span class="line">        -out /PATH/TO/SOMECERTFILE: 证书的保存路径；</span><br><span class="line"></span><br><span class="line"><span class="comment">#此过程中，会交互式让用户输入CA自身的一些信息，如国家、公司、组织、邮箱等。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#其中，国家、省份、城市、公司、组织必须和待签署的服务器所填的这些信息一样，不然会签署失败</span></span><br></pre></td></tr></table></figure></p>
<p>至此，CA就签署好了自己的证书，此后就可以等待并处理其他服务器的证书签署请求了</p>
<h1 id="给别的WEB服务器发证"><a href="#给别的WEB服务器发证" class="headerlink" title="给别的WEB服务器发证"></a>给别的WEB服务器发证</h1><p>假设另外一台WEB服务器想要开启https连接，那么就必须要有相关证书，而此前我们以及创建好了私有CA，此时就可以向我们刚创建的CA发起证书申请请求啦。(这里其实都是我们自身，如果是不同的主机流程几乎是一致的。)</p>
<p>申请者要先创建自己的私钥：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意，此步骤是在申请者端执行</span></span><br><span class="line">[root@ygq ~] (<span class="built_in">umask</span> 077; openssl genrsa -out /etc/httpd/ssl/httpd.key 2048)</span><br></pre></td></tr></table></figure></p>
<p>然后创建证书请求文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意，此步骤是在申请者端执行</span></span><br><span class="line">[root@ygq ~] openssl req -new -key /etc/httpd/ssl/httpd.key -out /etc/httpd/ssl/httpd.csr</span><br><span class="line">        <span class="comment">#这里由于是申请证书，而非CA自签，所以没有-x509</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#这里同样会交互式让用户输入很多信息，如国家等等的</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#其中，国家、省份、城市、公司、组织必须和CA自签时填的这些信息一样，不然会签署失败</span></span><br></pre></td></tr></table></figure></p>
<p>把刚创建的证书请求文件发给CA:(由于本例中CA和申请者是同一台主机，所以这一步就免了)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意，此步骤是在申请者端执行</span></span><br><span class="line"><span class="comment">#通过scp指令，将请求文件传至CA的/tmp目录下</span></span><br><span class="line">[root@ygq ~] scp  /etc/httpd/ssl/httpd.csr CA@CA_HOST_IP:/tmp</span><br></pre></td></tr></table></figure></p>
<p>CA签证<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意，此步骤是在CA端执行</span></span><br><span class="line">[root@ygq ~] openssl ca -<span class="keyword">in</span> /tmp/httpd.csr -out /etc/pki/CA/certs/httpd.crt</span><br></pre></td></tr></table></figure></p>
<p>签署完之后，将证书文件传给申请者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意，此步骤是在CA端执行</span></span><br><span class="line">[root@ygq ~] scp  /etc/pki/CA/certs/httpd.crt REQ@REQ_HOST_IP:/etc/httpd/ssl/httpd.crt</span><br></pre></td></tr></table></figure>
<p>至此，申请者(也就是想要开启https服务的WEB服务器)就有了证书啦，通过正确配置apache或者nginx等服务器的配置项，就可以开启https服务了！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/23/openssl/openssh简要应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ygqqq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="for the dream">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/23/openssl/openssh简要应用/" itemprop="url">openssh简要应用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-23T00:00:00+08:00">
                2017-09-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openssl/" itemprop="url" rel="index">
                    <span itemprop="name">openssl</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>OpenSSH 是 SSH (Secure SHell) 协议的免费开源实现。SSH协议族可以用来进行远程控制， 或在计算机之间传送文件。而实现此功能的传统方式，如telnet都是极为不安全的，并且会使用明文传送密码。OpenSSH提供了服务端后台程序和客户端工具，用来加密远程控件和文件传输过程中的数据，并由此来代替原来的类似服务。</p>
<p>现在SSH一般使用v2协议版本，双方主机基于DH算法做密钥交换，基于RSA或DSA算法实现身份认证。</p>
<p>OpenSSH的分为客户端和服务端两部分：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Clients端的配置文件：/etc/ssh/ssh_config</span><br><span class="line">Server端的配置文件：/etc/ssh/sshd_config</span><br><span class="line">Server端服务脚本：/etc/rc.d/init.d/sshd</span><br></pre></td></tr></table></figure></p>
<p>OpenSSH在Linux系统中默认是安装并启动的,主要的关键包有四个:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssh.x86_64                       5.3p1-104.el6   //服务端和客户端的公共组件        </span><br><span class="line">openssh-askpass.x86_64               5.3p1-104.el6   //     </span><br><span class="line">openssh-clients.x86_64               5.3p1-104.el6   //客户端安装包    </span><br><span class="line">openssh-server.x86_64                5.3p1-104.el6   //服务端安装包</span><br></pre></td></tr></table></figure></p>
<p>服务器端配置文件/etc/ssh/sshd_config 主要参数详解:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Port 22    //默认端口号，为了其安全一般要更改为其他端口</span></span><br><span class="line"><span class="comment">#AddressFamily any    //说明要监听任意地址</span></span><br><span class="line"><span class="comment">#ListenAddress 0.0.0.0 //监听本机所有IPV4的ip</span></span><br><span class="line"><span class="comment">#ListenAddress ::        //监听本机所有的IPV6的地址</span></span><br><span class="line">Protocol 2   监听的协议版本</span><br><span class="line"><span class="comment"># HostKey for protocol version 1   //说明key的协议版本</span></span><br><span class="line">SyslogFacility AUTHPRIV        <span class="comment">#使用AUTHPRIV 记录日志  </span></span><br><span class="line"><span class="comment">#LogLevel INFO    //log日志级别</span></span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line"><span class="comment"># Authentication:            //认证相关</span></span><br><span class="line"><span class="comment">#LoginGraceTime 2m    //登陆宽限时长  默认2分钟不登录自动关闭</span></span><br><span class="line"><span class="comment">#PermitRootLogin yes    //是否支持管理员直接登陆</span></span><br><span class="line"><span class="comment">#StrictModes yes    //是否使用严格模式 （严格检查用户的某些相关信息）</span></span><br><span class="line"><span class="comment">#MaxAuthTries 6        //最大尝试次数  （6次以后终端断开）</span></span><br><span class="line"><span class="comment">#MaxSessions 10        //最大并发允许链接数 （超过 将拒绝）</span></span><br><span class="line"><span class="comment">#RSAAuthentication yes    //是否支持RSA密钥认证</span></span><br><span class="line"><span class="comment">#PubkeyAuthentication yes    //是否支持公钥认证</span></span><br><span class="line"><span class="comment">#AuthorizedKeysFile     .ssh/authorized_keys  //默认保存口令的文件</span></span><br><span class="line"><span class="comment">#PermitEmptyPasswords no        //是否支持空密码登陆</span></span><br><span class="line">PasswordAuthentication yes</span><br><span class="line">                </span><br><span class="line">UsePAM yes //是否使用PAM 认证（ 是一种统一认证框架）</span><br><span class="line">X11Forwarding yes     <span class="comment">#是否转发图形界面请求 (可以打开远程服务器图形界面)</span></span><br><span class="line">Subsystem       sftp    /usr/libexec/openssh/sftp-server  </span><br><span class="line"><span class="comment">#UseDNS yes        //是否允许DNS反解  比较浪费时间一般更改为no</span></span><br><span class="line">/etc/ssh/ssh_known_hosts  <span class="comment">#保存已经认可主机的文件</span></span><br></pre></td></tr></table></figure></p>
<h1 id="基于秘钥认证-ssh免密登录"><a href="#基于秘钥认证-ssh免密登录" class="headerlink" title="基于秘钥认证(ssh免密登录)"></a>基于秘钥认证(ssh免密登录)</h1><h2 id="手动写入认证文件实现免密登陆"><a href="#手动写入认证文件实现免密登陆" class="headerlink" title="手动写入认证文件实现免密登陆"></a>手动写入认证文件实现免密登陆</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@ygq ~] ssh-keygen -t rsa  <span class="comment">#生成秘钥对</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):         <span class="comment">#如果使用密码，每次用到秘钥都要输密码，可以为空，不使用密码</span></span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.    <span class="comment">#私钥路径</span></span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.    <span class="comment">#公钥路径</span></span><br><span class="line">The key fingerprint is:</span><br><span class="line">72:4a:6f:4b:e2:d1:18:6e:eb:0c:12:1b:d2:ec:7f:20 root@ygq.centos6.9</span><br><span class="line">The key randomart image is:</span><br><span class="line">+--[ RSA 2048]----+</span><br><span class="line">|                 |</span><br><span class="line">|                 |</span><br><span class="line">|                 |</span><br><span class="line">| o               |</span><br><span class="line">|. =   + S        |</span><br><span class="line">| oE+.o O         |</span><br><span class="line">|  +...B =        |</span><br><span class="line">|   o =.* .       |</span><br><span class="line">|    .o= .        |</span><br><span class="line">+-----------------+</span><br><span class="line"></span><br><span class="line">[root@ygq .ssh] cat ~/.ssh/id_rsa.pub</span><br><span class="line"></span><br><span class="line"><span class="comment">#拷贝内容,追加写入远程主机的~/.ssh/authorized_keys文件即可实现本主机到远程主机的免密码登录</span></span><br></pre></td></tr></table></figure>
<h2 id="ssh-copy-id命令实现免密登陆"><a href="#ssh-copy-id命令实现免密登陆" class="headerlink" title="ssh-copy-id命令实现免密登陆"></a>ssh-copy-id命令实现免密登陆</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#生成秘钥对</span></span><br><span class="line">[root@ygq ~] ssh-keygen -t rsa</span><br><span class="line"></span><br><span class="line"><span class="comment">#将刚生成的公钥文件写入远程主机的~/.ssh/authorized_keys文件</span></span><br><span class="line">[root@ygq .ssh] ssh-copy-id -i id_rsa.pub root@192.167.0.69</span><br><span class="line"></span><br><span class="line"><span class="comment">#输入远程主机的密码，以后即可免密码登录</span></span><br></pre></td></tr></table></figure>
<h1 id="scp命令"><a href="#scp命令" class="headerlink" title="scp命令"></a>scp命令</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scp [OPTIONS] SRC...DEST</span><br><span class="line">    -r <span class="comment">#递归复制文件夹</span></span><br><span class="line">    -p <span class="comment">#保存源文件元数据信息中的属主、属组及权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制本地当前目录下aa.gz文件到远程主机的/root目录下</span></span><br><span class="line">scp aa.gz root@192.167.0.69:/root</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/22/openssl/openssl详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ygqqq">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="for the dream">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/22/openssl/openssl详解/" itemprop="url">openssl详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-22T00:00:00+08:00">
                2017-09-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/openssl/" itemprop="url" rel="index">
                    <span itemprop="name">openssl</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h1><h2 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h2><p>对称加密特点：</p>
<ul>
<li>加密和解密使用同一个密钥</li>
<li>将原始数据分割成固定大小的块，逐个进行加密，加解密速度快</li>
</ul>
<p>缺点：</p>
<ul>
<li>使用人数越来越多时，所需的秘钥也越来越多</li>
<li>秘钥如何分发？</li>
</ul>
<p>常见的对称加密算法有：DES(已被攻破，后来有了3DES)、AES、RC6等等。</p>
<h2 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h2><blockquote>
<p>最重要的特性就是：基于公钥加密的，必须使用对应私钥解密；基于私钥加密的，必须使用对应公钥解密！</p>
</blockquote>
<p>非对称加密：</p>
<ul>
<li>密钥成对出现，分为公钥和私钥，公钥公开给所有人，私钥自己留存，必须保证其私密性</li>
<li>基于公钥加密的，必须使用对应私钥解密；基于私钥加密的，必须使用对应公钥解密</li>
</ul>
<p>缺点：</p>
<ul>
<li>加解密速度比对称加密慢很多</li>
</ul>
<p>常见的非对称加密算法有：RSA, DSA等。</p>
<h2 id="单向加密"><a href="#单向加密" class="headerlink" title="单向加密"></a>单向加密</h2><blockquote>
<p>只能加密，无法解密，常用来提取特征码、确保数据完整性</p>
</blockquote>
<p>单项加密特点：</p>
<ul>
<li>定长输出，雪崩效应(数据的微小改变就能对提取的特征码产生巨大改变)</li>
</ul>
<p>常见的单向加密有：md5、sha等。</p>
<h1 id="加密通信细节"><a href="#加密通信细节" class="headerlink" title="加密通信细节"></a>加密通信细节</h1><p>互联网数据通信安全可靠的条件主要需要满足以下：</p>
<ul>
<li>数据来源可信，即数据发送者身份可信</li>
<li>数据具备完整性，即数据未被修改过</li>
<li>数据安全性，即数据不会被泄漏，他人截获后无法解密</li>
</ul>
<p>要想满足以上三种条件，必须同时使用对称加密、非对称加密、单向加密。</p>
<h2 id="只满足数据安全性的加密"><a href="#只满足数据安全性的加密" class="headerlink" title="只满足数据安全性的加密"></a>只满足数据安全性的加密</h2><p>由于公私钥加密速度慢，对称加密快，所以可以首先对数据部分使用对称加密。</p>
<p>再进一步考虑，公钥大家都可以获取，若使用自己私钥加密，数据被截获后直接就被破解，因此使用对方的公钥加密，又由于公钥加密速度慢，所以可以使用对方公钥对对称密钥部分进行加密。</p>
<p>数据的收取者解密时，将使用自己的私钥解密第一层，得到对称密钥后加密的数据，再使用对称密钥解密，这样就能获得最终数据。具体过程如下图所示：</p>
<p><img src="/images/linux/openssl/只满足数据安全性的加密.png" alt=""> </p>
<p>使用上述方法加密保证了数据的安全性，但是还未保证数据的完整性、一致性以及数据来源的可靠性。</p>
<h2 id="基于数字签名的数据通信"><a href="#基于数字签名的数据通信" class="headerlink" title="基于数字签名的数据通信"></a>基于数字签名的数据通信</h2><p>对于数据的完整性和一致性，使用单向加密算法，通过hash函数计算出数据独一无二的校验码，这个校验码称为“信息摘要(Message Digest)”。</p>
<p>对于数据来源可靠性，使用自己的私钥加密即可验证身份，因为获得数据后使用公钥不能解密的就证明数据不是配对私钥加密的。但是私钥加密速度慢，所以只用私钥加密摘要信息，加密后的摘要信息称为“数字签名(Signature)”。</p>
<p>用户获得数字签名后的数据，首先使用数据来源方的公钥解密，这样获得了数据和信息摘要部分，并确认了数据来源的可靠性。由于这时候数据部分是没有被加密的，所以用户也可以使用同种单向加密算法计算出摘要信息，然后对比来源方的摘要信息和自己计算出的摘要信息，如果相等则证明数据完全未被修改过，是完整一致的。</p>
<p>如图所示分别是数字签名和确认数据的全过程。</p>
<p><img src="/images/linux/openssl/数字签名.png" alt=""> </p>
<p>因此只要使用数字签名就能保证数据来源的可靠性、数据的完整性，但无法满足数据的安全性。</p>
<h2 id="数据加密结合数字签名"><a href="#数据加密结合数字签名" class="headerlink" title="数据加密结合数字签名"></a>数据加密结合数字签名</h2><p>如果数据传输双方张三和李四不在意数据丢失的泄露性，那么可以不对数据进行加密，只要数字签名即可，即使被中间人王五截获了甚至截获后修改一番再发送给李四也无所谓，因为李四可以根据数字签名验证数据的来源及数据的完整性，若发现被修改后大不了不用了。</p>
<p>但是如果在意数据泄漏呢？就需要将数字签名和加密结合起来使用。即先对数据进行数字签名，再对签名后的整体进行加密。</p>
<p><img src="/images/linux/openssl/数字签名结合数据加密.png" alt=""> </p>
<p>但是这时还有一个漏洞，问题出在数字签名过程中私钥加密以及后面公钥解密的不安全性。图中李四在拿公钥A解密的时候，这个公钥A真的是张三的公钥吗？也许张三传输公钥给李四的过程中被王五截断，王五声称自己是张三，并把自己的公钥给了李四，然后王五用自己的私钥对木马程序进行签名，进行对称加密后再使用李四的公钥加密，最后传输给李四，这样一来李四以为王五就是张三，导致的结果是李四对木马程序完全信任。</p>
<p>如何解决这个漏洞呢？只要保证李四获得的公钥A真的是来源于张三即可，如何保证呢？互联网之下，数据传输的两端可能谁都不认识谁，谁也不相信谁，所以最终还是依靠公益性的第三方组织——CA。</p>
<h1 id="CA"><a href="#CA" class="headerlink" title="CA"></a>CA</h1><p>CA(Certificate Authority)是数字证书认证中心，常称为证书颁发机构，申请者提交自己的公钥和一些个人信息(如申请者国家，姓名，单位等)给CA，CA对申请者的这些信息<strong>单向加密生成摘要信息</strong>，然后使用CA自己的私钥加密整个摘要信息，这样就得到了CA对申请者的数字签名，在数字签名上再加上CA自己的一些信息(如CA的机构名称，CA层次路径等)以及该证书的信息(如证书有效期限)，就得到了所谓的数字证书。如下图所示：</p>
<p><img src="/images/linux/openssl/颁发证书.png" alt=""> </p>
<p>如果某用户信任了该CA，就获取了该CA的公钥(实际上信任CA的其中一个作用就是获取CA公钥)，使用该公钥解密数字证书就可以验证申请者的信息以及申请者公钥的可靠性（申请者的公钥只被CA的私钥加密，解密该私钥后只是需要验证可靠性）。</p>
<p>这里的关键是CA使用自己的私钥给申请者加密，那么如何保证CA是可信并且合法的呢？根CA是通过自签署数字证书的方式标榜自己的可信性和合法性，第一级子CA由根CA颁发合法数字证书，第二级直至所有的子CA都由上一级子CA颁发数字证书。对于多级子CA只需要信任根CA即可，因为获取了根CA的公钥，可以解密第一级子CA的证书并获取验证第一级子CA的公钥，层层递进，最终获取到为申请者颁发数字证书的机构并获取它的公钥。</p>
<p>正是这些根CA和子CA组成了PKI。</p>
<p>信任CA后，每次接收到需要解密的数字证书时，还要去该颁发机构指定网站的证书吊销列表（CRL）中查询该证书是否被吊销，对于吊销后的证书应该不予以信任，这是信任CA的第二个作用。导致证书被吊销的可能性不少，例如申请者的私钥被黑客获取，申请者申请吊销等。</p>
<p>也有公司使用自签的证书，例如某些银行、12306有时候就要求下载证书并安装。使用自签证书的好处当然是省钱、方便啦。</p>
<h2 id="SSL握手机制"><a href="#SSL握手机制" class="headerlink" title="SSL握手机制"></a>SSL握手机制</h2><p>有了CA颁发的数字证书后，通信机制就和上小节中所述的机制完全不同了。</p>
<p>一般来说基于SSL的通信都是单向验证服务端证书，不需要验证客户端证书。具体过程如下图：</p>
<p><img src="/images/linux/openssl/SSL握手.png" alt=""> </p>
<ol>
<li>Visitor给出协议版本号、一个客户端随机数(Client random)，以及客户端支持的加密方法</li>
<li>Server确认双方使用的加密方法，以及一个服务器生成的随机数(Server random)</li>
<li>Server发送数字证书给Visitor</li>
<li>Visitor确认数字证书有效(查看证书状态且查询证书吊销列表)，并使用信任的CA的公钥解密数字证书获得Server的公钥，然后生成一个新的46字节随机数(称为预备主密钥Pre-master secret)，并使用Server的公钥加密预备主密钥发给Server</li>
<li>Server使用自己的私钥，解密Visitor发来的预备主密钥</li>
<li>Visitor和Server双方都具有了(客户端随机数+服务端随机数+预备主密钥)，它们两者都根据约定的加密方法，使用这三个随机数生成对称密钥——主密钥(也称为对话密钥session key)，用来加密接下来的整个对话过程</li>
<li>之后所有的数据只需要使用“对话密钥”加密即可，不再需要多余的加密机制</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ygqqq</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/linux.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ygqqq</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
